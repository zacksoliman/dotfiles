{"version":3,"sources":["webpack:///webpack/bootstrap e28f054cd8d931595065","webpack:///./chrome/background.entry.js","webpack:///./lib/environment/common/listeners.js","webpack:///./lib/utils/Cache.js","webpack:///./lib/environment/common/messaging.js","webpack:///./images/css-off.png","webpack:///./images/css-off-small.png","webpack:///./images/css-on.png","webpack:///./images/css-on-small.png","webpack:///./chrome/_helpers.js"],"names":["addCommonBackgroundListeners","addListener","session","Map","operation","key","value","get","set","delete","has","clear","Error","cache","waiting","id","token","Promise","resolve","reject","handler","console","error","Cache","constructor","capacity","maxAge","Infinity","now","Date","entry","createTime","hitTime","size","Array","from","entries","sort","a","b","slice","forEach","createMessageHandler","isPromise","maybePromise","then","_sendMessage","_onListenerError","e","listeners","interceptors","transaction","type","callback","addInterceptor","sendMessage","data","context","interceptor","response","catch","message","sendSynchronous","_handleMessage","isResponse","sendResponse","listener","apiToPromise","func","args","results","chrome","runtime","lastError","length"],"mappings":"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","file":"background.entry.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e28f054cd8d931595065","/*\n\n\tRES is released under the GPL. However, I do ask a favor (obviously I don't/can't require it, I ask out of courtesy):\n\n\tBecause RES auto updates and is hosted from a central server, I humbly request that if you intend to distribute your own\n\tmodified Reddit Enhancement Suite, you name it something else and make it very clear to your users that it's your own\n\tbranch and isn't related to mine.\n\n\tRES is updated very frequently, and I get lots of tech support questions/requests from people on outdated versions. If\n\tyou're distributing RES via your own means, those recipients won't always be on the latest and greatest, which makes\n\tit harder for me to debug things and understand (at least with browsers that auto-update) whether or not people are on\n\ta current version of RES.\n\n\tI can't legally hold you to any of this - I'm just asking out of courtesy.\n\n\tThanks, I appreciate your consideration.  Without further ado, the all-important GPL Statement:\n\n\tThis program is free software: you can redistribute it and/or modify\n\tit under the terms of the GNU General Public License as published by\n\tthe Free Software Foundation, either version 3 of the License, or\n\t(at your option) any later version.\n\n\tThis program is distributed in the hope that it will be useful,\n\tbut WITHOUT ANY WARRANTY; without even the implied warranty of\n\tMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n\tGNU General Public License for more details.\n\n\tYou should have received a copy of the GNU General Public License\n\talong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n/* eslint-env webextensions */\n\nimport { addCommonBackgroundListeners } from '../lib/environment/common/listeners';\nimport { createMessageHandler } from '../lib/environment/common/messaging';\n\nimport cssOff from '../images/css-off.png';\nimport cssOffSmall from '../images/css-off-small.png';\nimport cssOn from '../images/css-on.png';\nimport cssOnSmall from '../images/css-on-small.png';\n\nimport { apiToPromise } from './_helpers';\n\nconst _sendMessage = apiToPromise(chrome.tabs.sendMessage);\n\nconst {\n\t_handleMessage,\n\tsendMessage,\n\taddListener,\n} = createMessageHandler((type, { transaction, isResponse, ...obj }, { sendResponse, tabId }) => {\n\tif (isResponse) {\n\t\tsendResponse(obj);\n\t} else {\n\t\t_sendMessage(tabId, { ...obj, type }).then(obj => {\n\t\t\t_handleMessage(type, { ...obj, transaction, isResponse: true });\n\t\t});\n\t}\n});\n\nchrome.runtime.onMessage.addListener(({ type, ...obj }, sender, sendResponse) => _handleMessage(type, obj, { ...sender.tab, sendResponse }));\n\n// Listeners\n\naddCommonBackgroundListeners(addListener);\n\naddListener('ajax', async ({ method, url, headers, data, credentials }) => {\n\tconst request = new XMLHttpRequest();\n\n\tconst load = Promise.race([\n\t\tnew Promise(resolve => (request.onload = resolve)),\n\t\tnew Promise(resolve => (request.onerror = resolve))\n\t\t\t.then(() => { throw new Error(`XHR error - url: ${url}`); }),\n\t]);\n\n\trequest.open(method, url, true);\n\n\tfor (const name in headers) {\n\t\trequest.setRequestHeader(name, headers[name]);\n\t}\n\n\tif (credentials) {\n\t\trequest.withCredentials = true;\n\t}\n\n\trequest.send(data);\n\n\tawait load;\n\n\t// Only store `status`, `responseText` and `responseURL` fields\n\treturn {\n\t\tstatus: request.status,\n\t\tresponseText: request.responseText,\n\t\tresponseURL: request.responseURL,\n\t};\n});\n\naddListener('permissions', ({ operation, permissions, origins }) => {\n\tswitch (operation) {\n\t\tcase 'contains':\n\t\t\treturn apiToPromise(chrome.permissions.contains)({ permissions, origins });\n\t\tcase 'request':\n\t\t\treturn apiToPromise(chrome.permissions.request)({ permissions, origins });\n\t\tcase 'remove':\n\t\t\treturn apiToPromise(chrome.permissions.remove)({ permissions, origins });\n\t\tdefault:\n\t\t\tthrow new Error(`Invalid permissions operation: ${operation}`);\n\t}\n});\n\n(async () => {\n\tconst _set = apiToPromise((items, callback) => chrome.storage.local.set(items, callback));\n\tconst set = (key, value) => _set({ [key]: value });\n\n\tconst MIGRATED_TO_CHROME_STORAGE = 'MIGRATED_TO_CHROME_STORAGE';\n\n\tif (localStorage.getItem(MIGRATED_TO_CHROME_STORAGE) !== MIGRATED_TO_CHROME_STORAGE) {\n\t\tawait Promise.all(Object.keys(localStorage).map(async key => {\n\t\t\ttry {\n\t\t\t\tawait set(key, JSON.parse(localStorage.getItem(key)));\n\t\t\t\tconsole.log(key);\n\t\t\t} catch (e) {\n\t\t\t\tawait set(key, localStorage.getItem(key));\n\t\t\t\tconsole.warn(key);\n\t\t\t}\n\t\t}));\n\t\tlocalStorage.setItem(MIGRATED_TO_CHROME_STORAGE, MIGRATED_TO_CHROME_STORAGE);\n\t}\n})();\n\naddListener('deleteCookies', cookies =>\n\tcookies.forEach(({ url, name }) => chrome.cookies.remove({ url, name }))\n);\n\naddListener('openNewTabs', ({ urls, focusIndex }, { id: tabId, index: currentIndex }) => {\n\turls.forEach((url, i) => chrome.tabs.create({\n\t\turl,\n\t\tselected: i === focusIndex,\n\t\tindex: ++currentIndex,\n\t\topenerTabId: tabId,\n\t}));\n});\n\naddListener('addURLToHistory', url => {\n\tchrome.history.addUrl({ url });\n});\n\naddListener('isURLVisited', async url =>\n\t(await apiToPromise(chrome.history.getVisits)({ url })).length > 0\n);\n\nchrome.pageAction.onClicked.addListener(({ id: tabId }) =>\n\tsendMessage('pageActionClick', undefined, { tabId })\n);\n\naddListener('pageAction', ({ operation, state }, { id: tabId }) => {\n\tswitch (operation) {\n\t\tcase 'show':\n\t\t\tchrome.pageAction.show(tabId);\n\t\t\tchrome.pageAction.setIcon({\n\t\t\t\ttabId,\n\t\t\t\tpath: {\n\t\t\t\t\t19: state ? cssOnSmall : cssOffSmall,\n\t\t\t\t\t38: state ? cssOn : cssOff,\n\t\t\t\t},\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 'hide':\n\t\tcase 'destroy':\n\t\t\tchrome.pageAction.hide(tabId);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow new Error(`Invalid pageAction operation: ${operation}`);\n\t}\n});\n\naddListener('multicast', async (request, { id: tabId, incognito }) =>\n\tPromise.all(\n\t\t(await apiToPromise(chrome.tabs.query)({ url: '*://*.reddit.com/*', status: 'complete' }))\n\t\t\t.filter(tab => tab.id !== tabId && tab.incognito === incognito)\n\t\t\t.map(({ id: tabId }) => sendMessage('multicast', request, { tabId }))\n\t)\n);\n\n\n\n// WEBPACK FOOTER //\n// ./chrome/background.entry.js","/* @flow */\n\nimport Cache from '../../utils/Cache';\nimport type { AddListener } from './messaging';\n\nexport function addCommonBackgroundListeners(addListener: AddListener<void>) {\n\tconst session = new Map();\n\n\taddListener('session', ([operation, key, value]) => {\n\t\tswitch (operation) {\n\t\t\tcase 'get':\n\t\t\t\treturn session.get(key);\n\t\t\tcase 'set':\n\t\t\t\tsession.set(key, value);\n\t\t\t\tbreak;\n\t\t\tcase 'delete':\n\t\t\t\treturn session.delete(key);\n\t\t\tcase 'has':\n\t\t\t\treturn session.has(key);\n\t\t\tcase 'clear':\n\t\t\t\treturn session.clear();\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Invalid session operation: ${operation}`);\n\t\t}\n\t});\n\n\tconst cache = new Cache();\n\n\taddListener('XHRCache', ([operation, key, value]) => {\n\t\tswitch (operation) {\n\t\t\tcase 'set':\n\t\t\t\treturn cache.set(key, value);\n\t\t\tcase 'check':\n\t\t\t\treturn cache.get(key, value);\n\t\t\tcase 'delete':\n\t\t\t\treturn cache.delete(key);\n\t\t\tcase 'clear':\n\t\t\t\treturn cache.clear();\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Invalid XHRCache operation: ${operation}`);\n\t\t}\n\t});\n\n\tconst waiting = new Map();\n\n\taddListener('authFlow', ({ operation, id, token }) => {\n\t\tswitch (operation) {\n\t\t\tcase 'start':\n\t\t\t\tif (waiting.has(id)) {\n\t\t\t\t\tthrow new Error(`Auth handler for id: ${id} already exists.`);\n\t\t\t\t}\n\t\t\t\treturn new Promise((resolve, reject) => waiting.set(id, { resolve, reject }));\n\t\t\tcase 'complete': {\n\t\t\t\tconst handler = waiting.get(id);\n\t\t\t\tif (!handler) {\n\t\t\t\t\tconsole.error(`No auth handler for id: ${id} (sent token: ${token}).`);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\twaiting.delete(id);\n\t\t\t\thandler.resolve(token);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tcase 'cancel': {\n\t\t\t\tconst handler = waiting.get(id);\n\t\t\t\tif (!handler) {\n\t\t\t\t\tconsole.error(`No auth handler for id: ${id} (attempted cancellation).`);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\twaiting.delete(id);\n\t\t\t\thandler.reject(new Error('Auth flow cancelled.'));\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Invalid authFlow operation: ${operation}`);\n\t\t}\n\t});\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/environment/common/listeners.js","/* @flow */\n\nexport default class Cache<K, V> extends Map<K, $FlowIgnore> {\n\tcapacity: number;\n\n\tconstructor(capacity?: number = 500) {\n\t\tsuper();\n\t\tthis.capacity = capacity;\n\t}\n\n\tget(key: K, maxAge?: number = Infinity): V | void {\n\t\tconst now = Date.now();\n\t\tconst entry = super.get(key);\n\t\tif (entry && (now - entry.createTime < maxAge)) {\n\t\t\tentry.hitTime = now;\n\t\t\treturn entry.value;\n\t\t}\n\t}\n\n\tset(key: K, value: V): $FlowIgnore {\n\t\tconst now = Date.now();\n\t\tsuper.set(key, { value, createTime: now, hitTime: now });\n\n\t\tif (this.size > this.capacity) {\n\t\t\t// evict least-recently used (hit)\n\t\t\tArray.from(this.entries())\n\t\t\t\t.sort(([, a], [, b]) => b.hitTime - a.hitTime)\n\t\t\t\t.slice((this.capacity / 2) | 0)\n\t\t\t\t.forEach(([key]) => this.delete(key));\n\t\t}\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/utils/Cache.js","/* @flow */\n\ntype MessagePayload = {\n\tdata?: mixed,\n\terror?: string,\n\ttransaction: number,\n\tisResponse?: boolean,\n};\n\ntype InternalMessageSender<Ctx> = (type: string, msg: MessagePayload, context: Ctx) => void;\n\ntype InternalMessageHandler<Ctx> = (type: string, msg: MessagePayload, context: Ctx) => boolean;\n\nexport type MessageSender<Ctx> = (type: string, data: mixed, context: Ctx) => Promise<mixed>;\n\nexport type SynchronousMessageSender<Ctx> = (type: string, data: mixed, context: Ctx) => mixed;\n\nexport type AddListener<Ctx> = (type: string, callback: ListenerCallback<Ctx>) => void;\n\ntype ListenerCallback<Ctx> = (data: any, context: Ctx) => Promise<mixed> | mixed;\n\ntype HandlerFunctions<Ctx> = {\n\t_handleMessage: InternalMessageHandler<Ctx>,\n\tsendMessage: MessageSender<Ctx>,\n\tsendSynchronous: SynchronousMessageSender<Ctx>,\n\taddListener: AddListener<Ctx>,\n\taddInterceptor: AddListener<Ctx>,\n};\n\nfunction isPromise(maybePromise) {\n\treturn maybePromise && typeof maybePromise === 'object' && typeof maybePromise.then === 'function';\n}\n\nexport function createMessageHandler<Ctx>(_sendMessage: InternalMessageSender<Ctx>, _onListenerError: (e: mixed) => void = e => console.error(e)): HandlerFunctions<Ctx> {\n\tconst listeners = new Map();\n\tconst interceptors = new Map();\n\tconst waiting = new Map();\n\tlet transaction = 0;\n\n\tfunction addListener(type, callback) {\n\t\tif (listeners.has(type)) {\n\t\t\tthrow new Error(`Listener for \"${type}\" already exists.`);\n\t\t}\n\t\tlisteners.set(type, callback);\n\t}\n\n\tfunction addInterceptor(type, callback) {\n\t\tif (interceptors.has(type)) {\n\t\t\tthrow new Error(`Interceptor for \"${type}\" already exists.`);\n\t\t}\n\t\tinterceptors.set(type, callback);\n\t}\n\n\tfunction sendMessage(type, data, context) {\n\t\tconst interceptor = interceptors.get(type);\n\t\tif (interceptor) {\n\t\t\ttry {\n\t\t\t\tconst response = interceptor(data, context);\n\t\t\t\tif (isPromise(response) /*:: && response instanceof Promise */) {\n\t\t\t\t\treturn response.catch(e => Promise.reject(new Error(`Error in \"${type}\" interceptor: ${e.message || e}`)));\n\t\t\t\t}\n\t\t\t\treturn Promise.resolve(response);\n\t\t\t} catch (e) {\n\t\t\t\treturn Promise.reject(new Error(`Error in \"${type}\" interceptor: ${e.message || e}`));\n\t\t\t}\n\t\t}\n\n\t\t++transaction;\n\n\t\t_sendMessage(type, { data, transaction }, context);\n\n\t\treturn new Promise((resolve, reject) => waiting.set(transaction, { resolve, reject }));\n\t}\n\n\tfunction sendSynchronous(type, data, context) {\n\t\tconst interceptor = interceptors.get(type);\n\t\tif (!interceptor) {\n\t\t\tthrow new Error(`Unrecognised interceptor type: ${type}`);\n\t\t}\n\n\t\ttry {\n\t\t\treturn interceptor(data, context);\n\t\t} catch (e) {\n\t\t\tthrow new Error(`Error in \"${type}\" interceptor: ${e.message || e}`);\n\t\t}\n\t}\n\n\tfunction _handleMessage(type, { data, transaction, error, isResponse }, context) {\n\t\tif (isResponse) {\n\t\t\tconst handler = waiting.get(transaction);\n\t\t\tif (!handler) {\n\t\t\t\tthrow new Error(`No \"${type}\" response handler (transaction ${transaction}) - this should never happen.`);\n\t\t\t}\n\t\t\twaiting.delete(transaction);\n\n\t\t\tif (error) {\n\t\t\t\thandler.reject(new Error(`Error in target's \"${type}\" handler: ${error}`));\n\t\t\t} else {\n\t\t\t\thandler.resolve(data);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction sendResponse({ data, error }: { data?: mixed, error?: string }) {\n\t\t\t_sendMessage(type, { data, transaction, error, isResponse: true }, context);\n\t\t}\n\n\t\tconst listener = listeners.get(type);\n\t\tif (!listener) {\n\t\t\tsendResponse({ error: `Unrecognised message type: ${type}` });\n\t\t\treturn false;\n\t\t}\n\n\t\tlet response;\n\n\t\ttry {\n\t\t\tresponse = listener(data, context);\n\t\t} catch (e) {\n\t\t\tsendResponse({ error: e.message || e });\n\t\t\t_onListenerError(e);\n\t\t\treturn false;\n\t\t}\n\n\t\tif (isPromise(response) /*:: && response instanceof Promise */) {\n\t\t\tresponse\n\t\t\t\t.then(\n\t\t\t\t\tdata => sendResponse({ data }),\n\t\t\t\t\te => {\n\t\t\t\t\t\tsendResponse({ error: e.message || e });\n\t\t\t\t\t\t_onListenerError(e);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t// true = response will be handled asynchronously (needed for Chrome)\n\t\t\treturn true;\n\t\t}\n\n\t\tsendResponse({ data: response });\n\n\t\treturn false;\n\t}\n\n\treturn {\n\t\t_handleMessage,\n\t\tsendMessage,\n\t\tsendSynchronous,\n\t\taddListener,\n\t\taddInterceptor,\n\t};\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/environment/common/messaging.js","module.exports = __webpack_public_path__ + \"css-off.png\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./images/css-off.png\n// module id = 4\n// module chunks = 0","module.exports = __webpack_public_path__ + \"css-off-small.png\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./images/css-off-small.png\n// module id = 5\n// module chunks = 0","module.exports = __webpack_public_path__ + \"css-on.png\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./images/css-on.png\n// module id = 6\n// module chunks = 0","module.exports = __webpack_public_path__ + \"css-on-small.png\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./images/css-on-small.png\n// module id = 7\n// module chunks = 0","/* eslint-env webextensions */\n\nexport function apiToPromise(func) {\n\treturn (...args) =>\n\t\tnew Promise((resolve, reject) =>\n\t\t\tfunc(...args, (...results) => {\n\t\t\t\tif (chrome.runtime.lastError) {\n\t\t\t\t\treject(new Error(chrome.runtime.lastError.message));\n\t\t\t\t} else {\n\t\t\t\t\tresolve(results.length > 1 ? results : results[0]);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./chrome/_helpers.js"],"sourceRoot":""}