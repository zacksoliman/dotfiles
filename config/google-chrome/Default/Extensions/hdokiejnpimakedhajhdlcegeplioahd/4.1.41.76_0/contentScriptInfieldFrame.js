var lpResizeEvent=function(){function e(){g||(g=setTimeout(function(){g=null;d&&d()},66))}var g,d;return{attachWindowResizeEvent:function(f){d=f;window.addEventListener("resize",e)},detachWindowResizeEvent:function(){d=null;window.removeEventListener("resize",e)}}}();
LPInfieldFrame=function(){function e(a,c){var b;return function(){var m=this,q=arguments;clearTimeout(b);b=setTimeout(function(){b=null;a.apply(m,q)},c)}}function g(a){if(h)h=!1;else{if(a.iframe&&!a.fieldEl)try{a.fieldEl=$(a.iframe).contents().find("#"+a.id)[0]}catch(m){}if(a&&("focus"!==a.eventType||!n)){if(c){if(b.id===a.id)return;f("away")}a.url="contentScriptPopup.html";b=a;c=LPFrame.openFrame({url:"contentScriptPopup.html",interfaceDefinition:Interfaces.InfieldPopupInterface});p();k();lpResizeEvent.attachWindowResizeEvent(k);
window.addEventListener("click",d,!0);bg.sendLpImprove("newinfieldopen",{source:"formv2",option:a.eventType})}}}function d(a){if(b&&(a.target.id===b.id||a.target===b.fieldEl))return!1;f("away");return!0}function f(a){c&&(a&&(h="action"==a,bg.sendLpImprove("newinfieldclose",{source:"formv2",option:a}),"close"===a&&(n=!0,b.fieldEl&&(LP_addEventHandler(b.fieldEl,"click",launchPopup,!1),realLaunchPopup&&b.fieldEl.removeEventListener("focus",realLaunchPopup)))),window.removeEventListener("click",d),lpResizeEvent.detachWindowResizeEvent(),
c&&c.close(),b=c=null)}function r(a,c){var b={};a&&(b.height=a);c&&(b.width=c);return b}function t(a){var b={top:0,left:0};if(a){var e={top:0,left:0};a.iframe&&(e=a.iframe.getBoundingClientRect());var d={bottom:parseInt(a.posy),left:parseInt(a.posx),width:a.width};a.fieldEl&&a.fieldEl.getBoundingClientRect?d=a.fieldEl.getBoundingClientRect():a.fieldBox&&(d=a.fieldBox);b.top=window.pageYOffset+e.top+d.bottom;b.left=window.pageXOffset+e.left+d.left+d.width-375;var f=360;0>=b.left&&(b.left=window.pageXOffset+
e.left+d.left-10,f=25)}a=f;c&&c.getInterface().lpInfield.setArrowPosition({position:a});return b}function p(){c&&c.css({display:"block",position:"absolute",height:"0px"})}function k(){b.fieldEl&&!$(b.fieldEl).is(":visible")?f():c&&c.css(t(b))}var c,b,h,l,n=!1;return{close:f,show:p,openFrame:function(a){l=l||e(g,100);l(a)},resizeFrame:function(a,b){c&&c.css(r(a,b))},positionFrame:k}}();
function LP_keypress_handler(e){27==e.keyCode?LPInfieldFrame.close("close"):9==e.keyCode&&LPInfieldFrame.close("away")};
