var CPWbot_bg,g_v2engine=!0,g_v3engine=!1;CPWbot_bg||(CPWbot_bg=new CPWbot_bg_lib);
var g_cpw_server_initiated_tabid=null,g_cpw_do_fakeui=!1,TYPE_ID="id",TYPE_NAME="name",TYPE_XPATH="xpath",FN_LOGIN=1,FN_PASSWORD=2,FN_LOGIN_OTHER=5,FN_CURRENT_PASS=10,FN_NEW_PASS=11,FN_NEW_PASS_CONFIRM=12,FN_CPW_OTHER=13,FN_CPW_INVALID=14,FN_LOGIN_INVALID=15,FN_LOGIN_SUCCESS=16,FN_LOGIN_SUCCESS_INVALID=17,FN_NAVIGATE_TO_CPW=18,FN_CPW_SUCCESS=19,FN_CPW_SUCCESS_INVALID=20,FN_NAVIGATE_TO_ACCTMGMT=21,FN_CPW_SUBMIT=22,FN_IS_LOGGED_IN=23,FN_IS_LOGGED_IN_NEGATION=24,FN_LOGIN_SUBMIT=25,FN_POPUP_EXISTS=26,
FN_POPUP_DISMISS=27,FN_REVEAL_LOGIN=28,FN_CHALLENGE_LOGIN=29,FN_CHALLENGE_PASSWORD=30,FN_CHALLENGE_OTHER=31,FN_CHALLENGE_SUBMIT=32,FN_CHALLENGE_INVALID=33,FN_CHALLENGE_SUCCESS=34,FN_CHALLENGE_SUCCESS_INVALID=35,FN_EPHEMERAL_STATE=37,FN_NAVIGATE_TO_LOGOUT=38,FN_CAPTCHA=39,FN_MULTI_FACTOR=40,FN_PASSWORD_HINT=41,FN_POPUP_EXISTS_INVALID=42,FN_FAKEUI_LOGGED_OUT_1=43,FN_FAKEUI_LOGGED_OUT_2=44,FN_FAKEUI_LOGGED_OUT_3=45,FN_FAKEUI_LOGGED_OUT_INPUT=46,FN_FAKEUI_LOGGED_IN_1=47,FN_FAKEUI_LOGGED_IN_2=48,FN_FAKEUI_LOGGED_IN_3=
49,FN_FAKEUI_LOGGED_IN_INPUT=50,FN_FORCE_FAIL=51,FN_CAPTCHA_SUCCESS=52,FN_MULTI_FACTOR_SUCCESS=53,FN_PASSWORD_HINT_SUCCESS=54,FN_LOGIN_ENTRY_INVALID=55,FN_LOGIN_ENTRY_USERNAME=56,FN_LOGIN_ENTRY_SUBMIT=57,FN_LOGIN_ENTRY_PASSWORD=58,FN_LOGIN_ENTRY_SUCCESS_INVALID=59,FN_LOGIN_ENTRY_SUCCESS=60,FN_REVEAL_LOGOUT=61,CONST_CLICK_NOMINAL=0,CONST_CLICK_NO_FOCUS=1,CONST_CLICK_MOUSEDOWN=2,CONST_CLICK_STRANGE=3,JS_PRE_NAVIGATE_CPW=1,JS_PRE_LOGIN=2,JS_POST_NAVIGATE_CPW=3,JS_POST_LOGIN=4,JS_PRE_CPW=5,JS_POST_CPW=
6,JS_PRE_ACCTMGMT=7,JS_POST_ACCTMGMT=8,JS_LOGIN_REVEAL=9,JS_VALIDATE_LOGIN_SUCCESS=10,JS_VALIDATE_CPW_SUCCESS=11,JS_LOGIN_SUBMIT=12,JS_FINISH=13,JS_PRE_CHALLENGE=14,JS_POST_CHALLENGE=15,JS_CHALLENGE_SUBMIT=16,JS_VALIDATE_CHALLENGE_SUCCESS=17,JS_BEGIN=18,JS_PRE_LOGOUT=19,JS_POST_LOGOUT=20,JS_LOGIN_ENTRY_SUBMIT=21,JS_PRE_LOGIN_ENTRY=22,JS_POST_LOGIN_ENTRY=23,JS_VALIDATE_LOGIN_ENTRY_SUCCESS=24,JS_PRE_DOCAPTCHA=25,JS_POST_DOCAPTCHA=26;
function replace_constants(f){if(!f)return null;if("undefined"!=typeof f.field_info)for(var g=0;g<f.field_info.length;g++){if("undefined"!=typeof f.field_info[g].id_type)switch(f.field_info[g].id_type){case "TYPE_ID":f.field_info[g].id_type=TYPE_ID;break;case "TYPE_NAME":f.field_info[g].id_type=TYPE_NAME;break;case "TYPE_XPATH":f.field_info[g].id_type=TYPE_XPATH}if("undefined"!=typeof f.field_info[g].id_function)switch(f.field_info[g].id_function){case "FN_LOGIN":f.field_info[g].id_function=FN_LOGIN;
break;case "FN_PASSWORD":f.field_info[g].id_function=FN_PASSWORD;break;case "FN_LOGIN_OTHER":f.field_info[g].id_function=FN_LOGIN_OTHER;break;case "FN_CURRENT_PASS":f.field_info[g].id_function=FN_CURRENT_PASS;break;case "FN_NEW_PASS":f.field_info[g].id_function=FN_NEW_PASS;break;case "FN_NEW_PASS_CONFIRM":f.field_info[g].id_function=FN_NEW_PASS_CONFIRM;break;case "FN_CPW_OTHER":f.field_info[g].id_function=FN_CPW_OTHER;break;case "FN_CPW_INVALID":f.field_info[g].id_function=FN_CPW_INVALID;break;case "FN_LOGIN_INVALID":f.field_info[g].id_function=
FN_LOGIN_INVALID;break;case "FN_LOGIN_SUCCESS":f.field_info[g].id_function=FN_LOGIN_SUCCESS;break;case "FN_LOGIN_SUCCESS_INVALID":f.field_info[g].id_function=FN_LOGIN_SUCCESS_INVALID;break;case "FN_NAVIGATE_TO_CPW":f.field_info[g].id_function=FN_NAVIGATE_TO_CPW;break;case "FN_CPW_SUCCESS":f.field_info[g].id_function=FN_CPW_SUCCESS;break;case "FN_CPW_SUCCESS_INVALID":f.field_info[g].id_function=FN_CPW_SUCCESS_INVALID;break;case "FN_NAVIGATE_TO_ACCTMGMT":f.field_info[g].id_function=FN_NAVIGATE_TO_ACCTMGMT;
break;case "FN_CPW_SUBMIT":f.field_info[g].id_function=FN_CPW_SUBMIT;break;case "FN_IS_LOGGED_IN":f.field_info[g].id_function=FN_IS_LOGGED_IN;break;case "FN_IS_LOGGED_IN_NEGATION":f.field_info[g].id_function=FN_IS_LOGGED_IN_NEGATION;break;case "FN_LOGIN_SUBMIT":f.field_info[g].id_function=FN_LOGIN_SUBMIT;break;case "FN_POPUP_EXISTS":f.field_info[g].id_function=FN_POPUP_EXISTS;break;case "FN_POPUP_DISMISS":f.field_info[g].id_function=FN_POPUP_DISMISS;break;case "FN_REVEAL_LOGIN":f.field_info[g].id_function=
FN_REVEAL_LOGIN;break;case "FN_CHALLENGE_LOGIN":f.field_info[g].id_function=FN_CHALLENGE_LOGIN;break;case "FN_CHALLENGE_PASSWORD":f.field_info[g].id_function=FN_CHALLENGE_PASSWORD;break;case "FN_CHALLENGE_OTHER":f.field_info[g].id_function=FN_CHALLENGE_OTHER;break;case "FN_CHALLENGE_SUBMIT":f.field_info[g].id_function=FN_CHALLENGE_SUBMIT;break;case "FN_CHALLENGE_INVALID":f.field_info[g].id_function=FN_CHALLENGE_INVALID;break;case "FN_CHALLENGE_SUCCESS":f.field_info[g].id_function=FN_CHALLENGE_SUCCESS;
break;case "FN_CHALLENGE_SUCCESS_INVALID":f.field_info[g].id_function=FN_CHALLENGE_SUCCESS_INVALID;break;case "FN_NAVIGATE_TO_LOGOUT":f.field_info[g].id_function=FN_NAVIGATE_TO_LOGOUT;break;case "FN_EPHEMERAL_STATE":f.field_info[g].id_function=FN_EPHEMERAL_STATE;break;case "FN_CAPTCHA":f.field_info[g].id_function=FN_CAPTCHA;break;case "FN_MULTI_FACTOR":f.field_info[g].id_function=FN_MULTI_FACTOR;break;case "FN_PASSWORD_HINT":f.field_info[g].id_function=FN_PASSWORD_HINT;break;case "FN_POPUP_EXISTS_INVALID":f.field_info[g].id_function=
FN_POPUP_EXISTS_INVALID;break;case "FN_FORCE_FAIL":f.field_info[g].id_function=FN_FORCE_FAIL;break;case "FN_CAPTCHA_SUCCESS":f.field_info[g].id_function=FN_CAPTCHA_SUCCESS;break;case "FN_MULTI_FACTOR_SUCCESS":f.field_info[g].id_function=FN_MULTI_FACTOR_SUCCESS;break;case "FN_PASSWORD_HINT_SUCCESS":f.field_info[g].id_function=FN_PASSWORD_HINT_SUCCESS;break;case "FN_LOGIN_ENTRY_INVALID":f.field_info[g].id_function=FN_LOGIN_ENTRY_INVALID;break;case "FN_LOGIN_ENTRY_USERNAME":f.field_info[g].id_function=
FN_LOGIN_ENTRY_USERNAME;break;case "FN_LOGIN_ENTRY_PASSWORD":f.field_info[g].id_function=FN_LOGIN_ENTRY_PASSWORD;break;case "FN_LOGIN_ENTRY_SUBMIT":f.field_info[g].id_function=FN_LOGIN_ENTRY_SUBMIT;break;case "FN_LOGIN_ENTRY_SUCCESS":f.field_info[g].id_function=FN_LOGIN_ENTRY_SUCCESS;break;case "FN_LOGIN_ENTRY_SUCCESS_INVALID":f.field_info[g].id_function=FN_LOGIN_ENTRY_SUCCESS_INVALID;break;case "FN_REVEAL_LOGOUT":f.field_info[g].id_function=FN_REVEAL_LOGOUT;break;case "FN_FAKEUI_LOGGED_IN_1":f.field_info[g].id_function=
FN_FAKEUI_LOGGED_IN_1;break;case "FN_FAKEUI_LOGGED_IN_2":f.field_info[g].id_function=FN_FAKEUI_LOGGED_IN_2;break;case "FN_FAKEUI_LOGGED_IN_3":f.field_info[g].id_function=FN_FAKEUI_LOGGED_IN_3;break;case "FN_FAKEUI_LOGGED_IN_INPUT":f.field_info[g].id_function=FN_FAKEUI_LOGGED_IN_INPUT;break;case "FN_FAKEUI_LOGGED_OUT_1":f.field_info[g].id_function=FN_FAKEUI_LOGGED_OUT_1;break;case "FN_FAKEUI_LOGGED_OUT_2":f.field_info[g].id_function=FN_FAKEUI_LOGGED_OUT_2;break;case "FN_FAKEUI_LOGGED_OUT_3":f.field_info[g].id_function=
FN_FAKEUI_LOGGED_OUT_3;break;case "FN_FAKEUI_LOGGED_OUT_OUTPUT":f.field_info[g].id_function=FN_FAKEUI_LOGGED_OUT_INPUT}}if("undefined"!=typeof f.jsfrags)for(g=0;g<f.jsfrags.length;g++)if("undefined"!=typeof f.jsfrags[g].jstype)switch(f.jsfrags[g].jstype){case "JS_PRE_NAVIGATE_CPW":f.jsfrags[g].jstype=JS_PRE_NAVIGATE_CPW;break;case "JS_PRE_LOGIN":f.jsfrags[g].jstype=JS_PRE_LOGIN;break;case "JS_POST_NAVIGATE_CPW":f.jsfrags[g].jstype=JS_POST_NAVIGATE_CPW;break;case "JS_POST_LOGIN":f.jsfrags[g].jstype=
JS_POST_LOGIN;break;case "JS_PRE_CPW":f.jsfrags[g].jstype=JS_PRE_CPW;break;case "JS_POST_CPW":f.jsfrags[g].jstype=JS_POST_CPW;break;case "JS_PRE_ACCTMGMT":f.jsfrags[g].jstype=JS_PRE_ACCTMGMT;break;case "JS_POST_ACCTMGMT":f.jsfrags[g].jstype=JS_POST_ACCTMGMT;break;case "JS_LOGIN_REVEAL":f.jsfrags[g].jstype=JS_LOGIN_REVEAL;break;case "JS_VALIDATE_LOGIN_SUCCESS":f.jsfrags[g].jstype=JS_VALIDATE_LOGIN_SUCCESS;break;case "JS_VALIDATE_CPW_SUCCESS":f.jsfrags[g].jstype=JS_VALIDATE_CPW_SUCCESS;break;case "JS_LOGIN_SUBMIT":f.jsfrags[g].jstype=
JS_LOGIN_SUBMIT;break;case "JS_FINISH":f.jsfrags[g].jstype=JS_FINISH;break;case "JS_PRE_CHALLENGE":f.jsfrags[g].jstype=JS_PRE_CHALLENGE;break;case "JS_POST_CHALLENGE":f.jsfrags[g].jstype=JS_POST_CHALLENGE;break;case "JS_CHALLENGE_SUBMIT":f.jsfrags[g].jstype=JS_CHALLENGE_SUBMIT;break;case "JS_VALIDATE_CHALLENGE_SUCCESS":f.jsfrags[g].jstype=JS_VALIDATE_CHALLENGE_SUCCESS;break;case "JS_BEGIN":f.jsfrags[g].jstype=JS_BEGIN;break;case "JS_PRE_LOGOUT":f.jsfrags[g].jstype=JS_PRE_LOGOUT;break;case "JS_POST_LOGOUT":f.jsfrags[g].jstype=
JS_POST_LOGOUT;break;case "JS_PRE_LOGIN_ENTRY":f.jsfrags[g].jstype=JS_PRE_LOGIN_ENTRY;break;case "JS_POST_LOGIN_ENTRY":f.jsfrags[g].jstype=JS_POST_LOGIN_ENTRY;break;case "JS_LOGIN_ENTRY_SUBMIT":f.jsfrags[g].jstype=JS_LOGIN_ENTRY_SUBMIT;break;case "JS_PRE_DOCAPTCHA":f.jsfrags[g].jstype=JS_PRE_DOCAPTCHA;break;case "JS_POST_DOCAPTCHA":f.jsfrags[g].jstype=JS_POST_DOCAPTCHA}if("undefined"!=typeof f.click_flavor)switch(f.click_flavor){case "CLICK_NO_FOCUS":f.click_flavor=CONST_CLICK_NO_FOCUS;break;case "CLICK_MOUSEDOWN":f.click_flavor=
CONST_CLICK_MOUSEDOWN;break;case "CLICK_STRANGE":f.click_flavor=CONST_CLICK_STRANGE;break;default:f.click_flavor=CONST_CLICK_NOMINAL}return f}
var DEFAULT_CLICK_DELAY=250,DEFAULT_FILL_DELAY=250,DEFAULT_SESSION_TIMEOUT=12E4,DEFAULT_VALIDATE_TIMEOUT=1E4,CLICK_RETRY_TIME=5E3,recipe_template={version:1,symbolic:"",login_url:"",acctmgmt_url:null,cpw_url:"",logout_url:"",login_entry_url:"",fakeui_loggedout_url:"",fakeui_loggedin_url:"",validate_timeout:5E3,field_info:[],jsfrags:[],cpw_delay:250,login_delay:250,acctmgmt_delay:250,login_reveal_delay:250,logout_reveal_delay:250,logout_delay:250,fill_field_delay:250,click_field_delay:250,trigger_cpw_delay:0,
cpw_change_success_url:null,cpw_change_failure_url:null,login_failure_url:null,login_success_url:null,login_entry_failure_url:null,login_entry_success_url:null,challenge_invalidate_url:null,challenge_validate_url:null,click_flavor:CONST_CLICK_NOMINAL,generate_pref_overrides:null,reveal_login_js_delay:0,reveal_cpw_js_delay:0,navigate_acctmgmt_js_delay:0,postreveallogin_sleep:0,postacctmgmt_sleep:0,postrevealcpw_sleep:0,posttrigger_sleep:0,postlogout_sleep:0,start_delay:0,post_login_submit_delay:1100,
post_js_begin_delay:5555,js_finish_delay:2E3,session_timeout:DEFAULT_SESSION_TIMEOUT,document_complete_timeout:0,proceed_on_interactive:0,click_on_fields_on_fill:0,fill_password_fields_via_keys:0},r_tesco={},r_netflix={},minimal_recipe={symbolic:"",login_url:"",field_info:[],generate_pref_overrides:{minlength:6}},telegraph={symbolic:"Daily Telegraph"},amex={symbolic:"American Express",field_info:[],jsfrag:[]},boa={symbolic:"Bank of America",login_url:"https://www.bankofamerica.com/sitemap/hub/signin.go",
field_info:[{id_type:"TYPE_ID",id_value:"userId",id_function:"FN_LOGIN"},{id_type:"TYPE_ID",id_value:"password",id_function:"FN_PASSWORD"}],jsfrag:[]},capitalone={generate_pref_overrides:{mindigits:2,digits:1,special:0}},capitalone360={},testrig={symbolic:"Test",login_url:"http://www.netrot.net/~chang/form/formtest1.html",field_info:[{id_type:"TYPE_ID",id_value:"email",id_function:"FN_LOGIN"},{id_type:"TYPE_NAME",id_value:"password",id_function:"FN_PASSWORD"},{id_type:"TYPE_XPATH",id_value:"//input[@type='submit']",
id_function:"FN_LOGIN_SUBMIT"},{id_type:"TYPE_ID",id_value:"email",id_function:"FN_IS_LOGGED_IN_NEGATION"},{id_type:"TYPE_XPATH",id_value:"//input[@type='submit']",id_function:"FN_CPW_SUBMIT"}],jsfrag:[],generate_pref_overrides:{mindigits:1,digits:1,special:0,minlength:6}};
function CPWbot_bg_lib(){function f(a){m_last_overlay_msg=a}function g(){m_last_overlay_msg=""}function K(a){return a?a.logout_url:null}function J(a){if(!a)return null;var b=a.click_flavor;return"string"!=typeof b||(b=parseInt(b),isNaN(b))?a.click_flavor:b}function q(a){return M(a,FN_PASSWORD)}function Qa(a){return M(a,FN_LOGIN)}function Ra(a){return M(a,FN_LOGIN_SUBMIT)}function kb(a){return M(a,FN_REVEAL_LOGIN)}function M(a,b){if(!a||!a.field_info)return null;var d,c,e=null;for(d=0;d<a.field_info.length;d++)if(c=
a.field_info[d],c.id_function==b){e={id_type:c.id_type,id_value:c.id_value};break}return e}function Ab(a){return u(a,JS_PRE_NAVIGATE_CPW)}function lb(a){return u(a,JS_POST_NAVIGATE_CPW)}function Bb(a){return u(a,JS_PRE_ACCTMGMT)}function mb(a){return u(a,JS_POST_ACCTMGMT)}function Cb(a){return u(a,JS_PRE_CPW)}function Db(a){return u(a,JS_POST_CPW)}function sc(a){return u(a,JS_PRE_LOGIN)}function tc(a){return u(a,JS_POST_LOGIN)}function nb(a){return u(a,JS_LOGIN_REVEAL)}function uc(a){return u(a,JS_LOGIN_SUBMIT)}
function vc(a){return u(a,JS_LOGIN_ENTRY_SUBMIT)}function Eb(a){return u(a,JS_VALIDATE_LOGIN_SUCCESS)}function Fb(a){return u(a,JS_VALIDATE_CPW_SUCCESS)}function Gb(a){return u(a,JS_FINISH)}function wc(a){return u(a,JS_VALIDATE_CHALLENGE_SUCCESS)}function Hb(a){return u(a,JS_BEGIN)}function xc(a){return u(a,JS_PRE_LOGOUT)}function Ib(a){return u(a,JS_POST_LOGOUT)}function yc(a){return u(a,JS_PRE_LOGIN_ENTRY)}function zc(a){return u(a,JS_POST_LOGIN_ENTRY)}function Ac(a){return u(a,JS_VALIDATE_LOGIN_ENTRY_SUCCESS)}
function Bc(a){return u(a,JS_PRE_DOCAPTCHA)}function Cc(a){return u(a,JS_POST_DOCAPTCHA)}function Jb(a){var b=null;a&&"undefined"!=typeof a.cpw_change_success_url&&(b=a.cpw_change_success_url);return b}function Kb(a){var b=null;a&&"undefined"!=typeof a.cpw_change_failure_url&&(b=a.cpw_change_failure_url);return b}function Lb(a){var b=null;a&&"undefined"!=typeof a.login_failure_url&&(b=a.login_failure_url);return b}function Mb(a){var b=null;a&&"undefined"!=typeof a.login_success_url&&(b=a.login_success_url);
return b}function Dc(a){var b=null;a&&"undefined"!=typeof a.login_entry_failure_url&&(b=a.login_entry_failure_url);return b}function Ec(a){var b=null;a&&"undefined"!=typeof a.login_entry_success_url&&(b=a.login_entry_success_url);return b}function Fc(a){var b=null;a&&"undefined"!=typeof a.challenge_invalidate_url&&(b=a.challenge_invalidate_url);return b}function Gc(a){var b=null;a&&"undefined"!=typeof a.challenge_validate_url&&(b=a.challenge_validate_url);return b}function u(a,b){if(!a||!a.jsfrags)return null;
var d,c,e;for(d=0;d<a.jsfrags.length;d++)if(c=a.jsfrags[d],c.jstype==b){e=c.jsfrag;break}return e}function D(a,b,d){if(!b||!d)return null;if(b=d(b)){d=(new Date).getTime();null===d&&(d=0);var c=("function"==typeof lp_sha256?lp_sha256:SHA256)(a.toString()+b+d.toString());d=("function"==typeof fasthash?fasthash:"function"==typeof crc32?crc32:"function(j) { if (j) { return j.length; } return 0; }")(b);verbose_log("injecting javascript fragment into CS: "+b);m(P,"Injected Javascript into Document");sendCS(a,
{cmd:"run_cpwbot_js",req_id:c,js:b,hash:d},"all");return!0}return!1}function za(a){return"undefined"!=typeof g_sites?g_sites[a]:"undefined"!=typeof lpaccts?lpaccts[a]:null}function Nb(a,b,d,c,e,fa,f){if(!d)return!1;null===c&&(c=0);null===fa&&(fa=0);if("undefined"==typeof e||null===e)e=DEFAULT_FILL_DELAY;m(P,"Filling Field");f=(new Date).getTime();null===f&&(f=0);f=("function"==typeof lp_sha256?lp_sha256:SHA256)(a.toString()+d.id_value+f.toString());sendCS(a,{cmd:"cpwbot_fill_field",req_id:f,id_type:d.id_type,
id_value:d.id_value,field_value:b,type:"text",formname:"",should_click:c,should_fill_via_keys:fa,delay:e},"all");return!0}function pa(a,b,d,c,e,fa,f){if(!d)return!1;null===c&&(c=0);null===fa&&(fa=0);if("undefined"==typeof e||null===e)e=DEFAULT_FILL_DELAY;m(P,"Filling Password Field");var g=(new Date).getTime();null===g&&(g=0);g=("function"==typeof lp_sha256?lp_sha256:SHA256)(a.toString()+d.id_value+g.toString());sendCS(a,{cmd:"cpwbot_fill_field",req_id:g,id_type:d.id_type,id_value:d.id_value,field_value:b,
type:"password",formname:"",should_click:c,should_fill_via_keys:fa,delay:e,flavor:f},"all");return!0}function qa(a,b,d,c){if(!b)return!1;if("undefined"==typeof d||null===d)d=DEFAULT_CLICK_DELAY;"undefined"==typeof c&&(c=CONST_CLICK_NOMINAL);Ob=(new Date).getTime()+CLICK_RETRY_TIME+d;ob=!1;m(P,"Clicking");var e=(new Date).getTime();null===e&&(e=0);e=("function"==typeof lp_sha256?lp_sha256:SHA256)(a.toString()+b.id_value+e.toString());verbose_log("click_field id="+e+" saved to m_pwchange_last_click_field_id");
xa=e;Sa=0;b={cmd:"cpwbot_click_field",msgid:e,pwchangestate:h,id_type:b.id_type,id_value:b.id_value,delay:d,flavor:c};sendCS(a,b,"all");m_lastclick_metadata=b;return!0}function Ta(a,b,d){if(!b||!d)return!1;var c,e=za(d.aid);if(!e)return ra("given invalid aid - data consistency error?"),!1;CPWbot_bg.do_milestone(a,68,b);L("pre-login-form-js");D(a,b,sc);var f=Qa(b);d=q(b);var g=Ua(b),h=Va(b),w=rnd2=0,N=0,k=J(b);f&&(N++,c=getusernamefromacct(e),Nb(a,c,f,g,0*N+w,!1,k));d&&(N++,c=getpasswordfromacct(e),
pa(a,c,d,g,0*N+w+rnd2,h,k));L("post-login-form-js");D(a,b,tc);return!0}function pb(a,b,d){if(!b)return!1;CPWbot_bg.do_milestone(a,69,b);var c=!1;sa=!1;if(d=Ra(b)){c=DEFAULT_CLICK_DELAY;"undefined"!=typeof b.login_delay&&(c=b.login_delay);sa=!0;var e=J(b);qa(a,d,c,e);c=!0}D(a,b,uc)&&(c=!0);return c?null:!0}function Pb(a,b,d){if(!b||!d)return!1;var c,e=za(d.aid);if(!e)return ra("given invalid aid - data consistency error?"),!1;CPWbot_bg.do_milestone(a,75,b);D(a,b,yc);var f=M(b,FN_LOGIN_ENTRY_USERNAME);
d=M(b,FN_LOGIN_ENTRY_PASSWORD);var g=Ua(b),h=Va(b),w=rnd2=0,N=0,k=J(b);f&&(N++,c=getusernamefromacct(e),Nb(a,c,f,g,0*N+w,!1,k));d&&(N++,c=getpasswordfromacct(e),pa(a,c,d,g,0*N+w+rnd2,h,k));D(a,b,zc);return!0}function Qb(a,b,d){if(!b)return!1;CPWbot_bg.do_milestone(a,74,b);var c=!1;ta=!1;if(d=M(b,FN_LOGIN_ENTRY_SUBMIT)){c=DEFAULT_CLICK_DELAY;"undefined"!=typeof b.login_delay&&(c=b.login_delay);ta=!0;var e=J(b);qa(a,d,c,e);CPWbot_bg.mark_timestamp("wait_for_click_ack_M");c=!0}D(a,b,vc)&&(c=!0);return c?
null:!0}function Hc(a,b,d){if(!b||!d)return!1;m(E,"Updating with New Password");b=!0;var c=d.aid;console_log("cpwbot initiate: save_replace for aid="+c);var e=za(c);if(!e)return ra("given invalid aid - data consistency error?"),!1;a=lpdec_acct(d.newpw,e,"undefined"==typeof g_shares?lpshares:g_shares);d=lpdec_acct(d.curpw,e,"undefined"==typeof g_shares?lpshares:g_shares);if(e&&a&&d)if(e.pwprotect&&(b=!1),console_log("cpwbot initiate: calling changepw logic for aid="+c),g_isfirefox)(b||LP.securityPrompt())&&
lpchangepw(null,a,c,null,null,null,!0);else{var f={singleaid:c.toString(),newpw:a,autochange:1};b?changepw_wrapper(f):security_prompt(function(){changepw_wrapper(f)})}else verbose_log("no passwords to save? acct.aid = "+(e?e.aid:"null")+" cur="+(g_show_pw_in_logs||g_isadmin?d:"REDACTED")+" newpw="+(g_show_pw_in_logs||g_isadmin?a:"REDACTED"));return!0}function B(a){verbose_log("entered cpwbot_cs_finish to clean up "+a);if(null!==x)if(x!=a)null!==x&&verbose_log("stale call: started up a new password change on different tab - ABORT - tabid=="+
a+" g_pwchangetabid="+x);else{var b={aid:ca,recipe:C,desc:"cpwbot_finish"};g_v2engine?CPWbot_bg.wait_for_doc_complete(a,null,function(a){verbose_log("cpwbot_finish callback!  on tabid="+a);sendCS(a,{cmd:"cpwbot_finish"},"all")},b):sendCS(a,{cmd:"cpwbot_finish"})}}function Ic(a){var b=[],d=[FN_CPW_OTHER,FN_CURRENT_PASS,FN_NEW_PASS,FN_NEW_PASS_CONFIRM],c;for(c=0;c<d.length;c++){var e=H(a,d[c]);e&&0<e.length&&(b=b.concat(e))}return b}function Jc(a){var b=[],d=[FN_CPW_INVALID],c,e;for(c=0;c<d.length;c++){var f=
H(a,d[c]);if(f&&0<f.length)for(e=0;e<f.length;e++){var g=f[e];g&&b.push(g)}}return b}function Kc(a){var b=[],d=[FN_PASSWORD,FN_LOGIN_OTHER],c;for(c=0;c<d.length;c++){var e=H(a,d[c]);e&&0<e.length&&(b=b.concat(e))}return b}function Lc(a){var b=[],d=[FN_LOGIN_INVALID],c;for(c=0;c<d.length;c++){var e=H(a,d[c]);e&&0<e.length&&(b=b.concat(e))}return b}function Mc(a){var b=[],d=[FN_LOGIN_ENTRY_USERNAME],c;for(c=0;c<d.length;c++){var e=H(a,d[c]);e&&0<e.length&&(b=b.concat(e))}return b}function Nc(a){var b=
[],d=[FN_LOGIN_ENTRY_INVALID],c;for(c=0;c<d.length;c++){var e=H(a,d[c]);e&&0<e.length&&(b=b.concat(e))}return b}function Oc(a){var b=[],d=[FN_LOGIN_SUCCESS],c;for(c=0;c<d.length;c++){var e=H(a,d[c]);e&&0<e.length&&(b=b.concat(e))}return b}function Pc(a){var b=[],d=[FN_LOGIN_SUCCESS_INVALID],c;for(c=0;c<d.length;c++){var e=H(a,d[c]);e&&0<e.length&&(b=b.concat(e))}return b}function Qc(a){var b=[],d=[FN_LOGIN_ENTRY_SUCCESS],c;for(c=0;c<d.length;c++){var e=H(a,d[c]);e&&0<e.length&&(b=b.concat(e))}return b}
function Rc(a){var b=[],d=[FN_LOGIN_ENTRY_SUCCESS_INVALID],c;for(c=0;c<d.length;c++){var e=H(a,d[c]);e&&0<e.length&&(b=b.concat(e))}return b}function Sc(a){var b=[],d=[FN_CPW_SUCCESS],c;for(c=0;c<d.length;c++){var e=H(a,d[c]);e&&0<e.length&&(b=b.concat(e))}return b}function Tc(a){var b=[],d=[FN_CPW_SUCCESS_INVALID],c;for(c=0;c<d.length;c++){var e=H(a,d[c]);e&&0<e.length&&(b=b.concat(e))}return b}function Uc(a){var b=[],d=[FN_IS_LOGGED_IN],c;for(c=0;c<d.length;c++){var e=H(a,d[c]);e&&0<e.length&&(b=
b.concat(e))}return b}function Vc(a){var b=[],d=[FN_IS_LOGGED_IN_NEGATION],c;for(c=0;c<d.length;c++){var e=H(a,d[c]);e&&0<e.length&&(b=b.concat(e))}return b}function Wc(a){var b=[],d=[FN_CHALLENGE_PASSWORD,FN_CHALLENGE_OTHER],c;for(c=0;c<d.length;c++){var e=H(a,d[c]);e&&0<e.length&&(b=b.concat(e))}return b}function Xc(a){var b=[],d=[FN_CHALLENGE_INVALID],c;for(c=0;c<d.length;c++){var e=H(a,d[c]);e&&0<e.length&&(b=b.concat(e))}return b}function Yc(a){return M(recipe_obj,FN_CHALLENGE_SUCCESS)}function Zc(a){return M(recipe_obj,
FN_CHALLENGE_SUCCESS_INVALID)}function $c(a){var b=[],d=[FN_CAPTCHA,FN_PASSWORD_HINT,FN_MULTI_FACTOR],c;for(c=0;c<d.length;c++){var e=H(a,d[c]);e&&0<e.length&&(b=b.concat(e))}return b}function Rb(a){var b=[],d=[FN_CAPTCHA_SUCCESS,FN_PASSWORD_HINT_SUCCESS,FN_MULTI_FACTOR_SUCCESS],c;for(c=0;c<d.length;c++){var e=H(a,d[c]);e&&0<e.length&&(b=b.concat(e))}return b}function H(a,b){var d=[];if(!a||!a.field_info)return d;var c,e;for(c=0;c<a.field_info.length;c++)e=a.field_info[c],e.id_function==b&&(e={id_type:e.id_type,
id_value:e.id_value},d.push(e));return d}function Wa(a){var b=DEFAULT_VALIDATE_TIMEOUT;if(!a)return b;"undefined"!=typeof a.validate_timeout&&(a=parseInt(a.validate_timeout))&&!isNaN(a)&&(b=a);return b}function da(a,b,d){null===d&&(d=1);if(null===a||!b)return!1;var c=b.desc;d=b.recipe;var e=b.fn_url_failed,f=b.fn_url_success,g=b.fn_required;b=b.fn_rejected;r=!0;qb=(new Date).getTime();Ea=ua=!1;console_log("cpwbot check_tab_for_state for "+c);var g=g?g(d):[],h=b?b(d):[],w=CPWbot_bg.JSON.stringify(g),
N=CPWbot_bg.JSON.stringify(h);b=$c(d);b=CPWbot_bg.JSON.stringify(b);rb=Sb(a);if(0==g.length&&0==h.length&&!f&&!e)return L("WARN: "+c+" has no field or url criteria defined to validate against"),!0;g=Wa(d);f=f?f(d):null;e=e?e(d):null;h=(new Date).getTime();null===h&&(h=0);var k=("function"==typeof lp_sha256?lp_sha256:SHA256)(a.toString()+c+h.toString());S=k;Tb=w;Ub=N;verbose_log("interrogate id="+S+" desc="+c);F=[];d={cmd:"cpwbot_validate_state",desc:c,required_fields:w,rejected_fields:N,id:S,validate_timeout:g,
timestamp:h,proceed_on_interactive:Vb(d)?1:0,interactive_fields:b};f&&(d.required_url=f);e&&(d.rejected_url=e);Z=d;T=c;sendCS(a,d,"all");verbose_log("setup setimeout for "+g/1E3+" seconds finish_cpwbot_validate_state");setTimeout(function(){CPWbot_bg&&CPWbot_bg.finish_cpwbot_validate_state(a,k,w,N,c)},g);return null}function aa(){return null}function Xa(a,b,d,c){if(c||!CPWbot_bg.get_docaptchastate())b?m_last_overlay_msg=b:b=m_last_overlay_msg,d||(d=C),b={msg:b,symbolic:U(d)},b=CPWbot_bg.JSON.stringify(b),
sendCS(a,{cmd:"do_cpwbot_overlay",msg:b},g_CS_tops[a])}function Wb(a){sendCS(a,{cmd:"hide_cpwbot_overlay"},"all");return!0}function Xb(a){var b=null;if(!a)return b;"undefined"!=typeof a.generate_pref_overrides&&(b=a.generate_pref_overrides);return b}function Yb(a){var b=0;if(!a)return null;"undefined"!=typeof a.postacctmgmt_sleep&&(b=a.postacctmgmt_sleep);return b}function Zb(a){var b=0;if(!a)return null;"undefined"!=typeof a.postrevealcpw_sleep&&(b=a.postrevealcpw_sleep);return b}function sb(a){var b=
0;if(!a)return null;"undefined"!=typeof a.postreveallogin_sleep&&(b=a.postreveallogin_sleep);return b}function $b(a){var b=0;if(!a)return null;"undefined"!=typeof a.postlogout_sleep&&(b=a.postlogout_sleep);return b}function Vb(a){var b=!1;if(!a)return null;"undefined"!=typeof a.proceed_on_interactive&&(b=a.proceed_on_interactive?!0:!1,"0"===a.proceed_on_interactive&&(b=!1));return b}function ad(a){var b=0;if(!a)return null;"undefined"!=typeof a.start_delay&&(b=a.start_delay);return b}function tb(a){var b=
0;if(!a)return null;"undefined"!=typeof a.post_login_submit_delay&&(b=a.post_login_submit_delay);return b}function bd(a){var b=0;if(!a)return null;"undefined"!=typeof a.post_js_begin_delay&&(b=a.post_js_begin_delay);return b}function cd(a){var b=0;if(!a)return null;"undefined"!=typeof a.js_finish_delay&&(b=a.js_finish_delay);return b}function ub(a){var b=0;if(!a)return null;"undefined"!=typeof a.session_timeout&&"number"==typeof a.session_timeout&&(b=a.session_timeout);return b}function Ua(a){var b=
0;if(!a)return null;"undefined"!=typeof a.click_on_fields_on_fill&&(b=a.click_on_fields_on_fill?1:0);return b}function Va(a){var b=0;if(!a)return null;"undefined"!=typeof a.fill_password_fields_via_keys&&(b=a.fill_password_fields_via_keys?1:0);return b}function Ya(a){if(!a)return null;var b=DEFAULT_FILL_DELAY;"number"==typeof a.fill_field_delay&&(b=a.fill_field_delay);verbose_log("fill field delay : "+b);return b}function ac(a){var b=!1;if(!a)return null;"undefined"!=typeof a.document_complete_timeout&&
(b=a.document_complete_timeout);return b}function m(a,b){var d=["DEBUG","INFO","WARN","ERR"];if(a<P||a>Za)a=P;return g_isfirefox&&lpisadmin||g_isdebug||g_isadmin?(d="["+d[a]+"] "+b+"\n",vb+=d,verbose_log(d),write_history({cmd:"CPW",msg:d}),!0):!1}function bc(a,b){var d=!1;if(!b||!a)return debug&&L("validate_xpath: none"),d;try{var c=g_isfirefox?new a.defaultView.XPathEvaluator:new XPathEvaluator;if(!c&&debug)return L("NO XPATH EVALUATOR AVAILABLE ????"),!0;c.evaluate(b,a.documentElement,null,g_isfirefox?
a.defaultView.XPathResult.FIRST_ORDERED_NODE_TYPE:XPathResult.FIRST_ORDERED_NODE_TYPE,null);d=!0}catch(e){console_error("error validating '"+b+"', exception: "+e),d=!1}return d}function cc(a){var b=g_isfirefox?LP.getBrowser().selectedTab.linkedBrowser.contentDocument:document;if(!b||!a)return L("Bad Recipe: none"),!1;var d,c;if(!a||!a.login_url)return L("Bad Recipe: no login url"),!1;if(!U(a))return L("Bad Recipe: no symbolic"),!1;if(!a.field_info||0>=a.field_info.length)return L("Bad Recipe: no fields"),
!1;if(!dc(a))return!1;var e=!1,f=!1,g=!1,h=!1,w=!1,k=!1,m=!1,r=!1,q=!1;for(d=0;d<a.field_info.length;d++)switch(c=a.field_info[d],c.id_function){case FN_LOGIN:case FN_LOGIN_SUBMIT:case FN_PASSWORD:e=!0;break;case FN_CURRENT_PASS:case FN_NEW_PASS:case FN_NEW_PASS_CONFIRM:case FN_CPW_SUBMIT:w=!0;break;case FN_CPW_SUCCESS:case FN_CPW_SUCCESS_INVALID:k=!0;break;case FN_LOGIN_SUCCESS:case FN_LOGIN_SUCCESS_INVALID:g=!0;break;case FN_IS_LOGGED_IN:case FN_IS_LOGGED_IN_NEGATION:f=!0;break;case FN_NAVIGATE_TO_LOGOUT:r=
!0}if(Jb(a)||Kb(a)||Fb(a))m=!0;if(Mb(a)||Lb(a)||Eb(a))h=!0;K(a)&&(q=!0);if(!(e&&f&&(g||h)&&w&&(r||q)&&(k||m)))return L("Bad Recipe for "+U(a)+": has_login_fields?"+e+" has_logged_in_fields?"+f+" has_login_success_fields?"+g+" has_login_success_alt?"+h+" has_logout_field?"+r+" has_logout_alt?"+q+" has_cpw_fields?"+w+" has_cpw_success_fields?"+k+" has_cpw_success_alt?"+m),!1;for(d=0;d<a.field_info.length;d++)if(c=a.field_info[d],c.id_type==TYPE_XPATH){if(!bc(b,c.id_value))return L("Bad Recipe: bad xpath"),
!1;if(c.id_value&&0<c.id_value.indexOf("@clas,"))return L("Bad Recipe: @clas mispell"),!1}else if((c.id_type==TYPE_ID||c.id_type==TYPE_NAME)&&c.id_value&&(0<=c.id_value.indexOf("//")||0<=c.id_value.indexOf("text()")||0<=c.id_value.indexOf("contents(")))return L("Bad Recipe: xpath in non-xpath field def"),!1;return!0}function dc(a){var b,d,c,e=!0,f={id_function:1,id_value:1,id_type:1};if(!a.field_info||0>=a.field_info.length)return!1;for(d=0;d<a.field_info.length;d++)for(c in(b=a.field_info[d])&&"number"!=
typeof b.id_function&&(verbose_log(sprintf("field %s has invalid function '%s'",b.id_value,b.id_function)),e=!1),b)b.hasOwnProperty(c)&&!f[c]&&(verbose_log(sprintf("found invalid field property '%s'",c)),e=!1);f={jsfrag:1,jstype:1};if(a.jsfrags&&0<a.jsfrags.length)for(d=0;d<a.jsfrags.length;d++)for(c in(b=a.jsfrags[d])&&"number"!=typeof b.jstype&&(verbose_log(sprintf("js with invalid type '%s'",b.jstype)),e=!1),b)b.hasOwnProperty(c)&&!f[c]&&(verbose_log(sprintf("found invalid javascript property '%s'",
c)),e=!1);f={length:1,maxlength:1,minlength:1,special:1,digits:1,upper:1,lower:1,mindigits:1};if(a.generate_pref_overrides)for(c in a.generate_pref_overrides)a.generate_pref_overrides.hasOwnProperty(c)&&!f[c]&&(verbose_log(sprintf("found invalid generate preference '%s'",c)),e=!1);return e}function ec(){ma=va=ta=na=sa=ga=ea=ha=!1}function fc(a,b){var d=b.docnum,c=b.url;if(null===n)return!1;null!==n[d]&&"undefined"!=typeof n[d]||CPWbot_bg.clear_frame_score(a,d,c);n[d]+=2;return!0}function Sb(a){if(null===
n||null===a)return 0;var b,d=0,c;for(c in CS_table)CS_table.hasOwnProperty(c)&&(b=CS_table[c],b.tabid===a&&(b=b.docnum,(CPWbot_bg.skip_frame_by_score(b)||skip_CS_by_score(a,b))&&d++));return d}function gc(a,b){null!==a&&null!==g_CS_tops[a]&&sendCS(a,{cmd:"do_result_div",msg:b},g_CS_tops[a])}function hc(a,b){var d=ub(b);d||(d=DEFAULT_SESSION_TIMEOUT);null!==V&&0<V&&!isNaN(V)&&(d*=V);var c=CPWbot_bg.get_session();CPWbot_bg.session_timeout_st_id=setTimeout(function(){if(c!=CPWbot_bg.get_session())verbose_log("stale timeout");
else{CPWbot_bg.mark_timestamp("session_timeout");var b=CPWbot_bg.get_timestamp("session_timeout")-CPWbot_bg.get_timestamp("initial_cycle");verbose_log(sprintf("session timeout at %6.2f seconds after T=0",b/1E3));verbose_log("SESSION TIMEOUT WAKEUP");Fa||Ga||x!=a?(B(a),CPWbot_bg.cpwbot_cs_finish_complete(a)):(ic("timeout: a change is still running ? tabid="+a+"last state ="+h),CPWbot_bg.panic("session timeout"))}},d)}function jc(a,b,d){verbose_log("B1: validate_login_form ");h="B1";var c;c=CPWbot_bg.validate_login_form(a,
b,{aid:d.aid,recipe:b});if(null===c)return verbose_log("B1: validate_login_form / CS callout "),v=!0,L("VALIDATE_IN_DOCWAIT=true"),null;if(c)do_A4(a,b,d);else return CPWbot_bg.do_milestone(a,130,b,""),B(a),!1;return!0}function Aa(a,b,d){setTimeout(function(){lploggedin&&CPWbot_bg&&CPWbot_bg.engine(a,b,d)},250)}function dd(){var a,b;for(a=0;a<oa.length;a++)if(b=oa[a],"validate_response"==b.type)return!0;return!1}function kc(a,b){var d=m_lastclick_metadata;10<Sa&&verbose_log("too many click retries");
d&&(m(E,"Retry Click"),verbose_log("tabid="+a+" id_type="+d.id_type+" id_value="+d.id_value),sendCS(a,d,b),Sa++)}function ia(a){return(new Date).getTime()>Ob&&!ob?(ob=!0,kc(a,"all"),!0):!1}function ed(a){var b;p&&(b=p.initial_cycle-p.dopwchange,1E4<b&&0!=p.initial_cycle&&0!=p.dopwchange&&(V=2,lc(a,V)));return!0}function lc(a,b){L(sprintf("[%s] time factor adjustment=%6.2f",U(a),b));return!0}function mc(){}function nc(a,b){CPWbot_bg.do_milestone(a,138,b);B(a);CPWbot_bg.cpwbot_cs_finish_complete(a);
return!0}function ic(a){CPWbot_bg&&(m(Za,a),CPWbot_bg.phone_home(null,null,{severity:"fatal",msg:a}))}function ra(a){m(fd,a);return CPWbot_bg.phone_home(null,null,{severity:"warning",msg:a})}function Ba(a,b){var d;d=0<Rb(b).length?!0:!1;d?CPWbot_bg.do_milestone(a,9,b):(CPWbot_bg.do_milestone(a,139,b),B(a))}function U(a){return a?a.symbolic:""}function gd(a,b){a||(a=100);if(typeof("undefined"==b)||null==b||"undefined"==typeof Math)return!1;var d=random(a)+10;setTimeout(function(){b()},d);return!0}
var oc=this,pc=0,h=null,x=null,ja=null,C=null,ca=0,Z=null,S=null,T=null,wb=null,xa=null;g();var rb=null,F=[],$a=!1,ab=!1,bb=!1,cb=!1,I=!1,vb="",Fa=!1,Ga=!1,ha=!1,sa=!1,ga=!1,ea=!1,va=!1,ma=!1,na=!1,ta=!1,n={},ua=!1,Ea=!1,xb=!1,yb=!1,db=!1,eb=!1,fb=!1,wa=!1,gb=!1,hb=!1,k=[""];k[1]=gs("LastPass is loading...");k[2]=gs("LastPass is loading website...");k[3]=gs("LastPass is logging in...");k[4]=gs("LastPass is changing your password now...");k[5]=gs("LastPass is changing your password now...");k[6]=gs("LastPass is changing your password now...");
k[7]=gs("LastPass is changing your password now...");k[8]=gs("LastPass is logging in...");k[9]=gs("The website needs you to enter information. Please switch to the tab and enter it.");k[63]=gs("Congratulations! Your password for %s was updated, and is now saved in your LastPass vault. Your change will sync on every device.");k[128]=gs("We're sorry. We were not able to change your password automatically for %s. Your password was not changed.");k[248]=k[128]+" "+gs("The random password that was generated has been saved to your vault.");
k[136]=k[128];k[133]=gs("Timed out waiting for the page to load.  Retry?");k[130]=k[128];k[129]=k[128];k[134]=k[128];k[135]=k[128];k[131]=k[128];k[132]=k[128];k[137]=k[128];k[138]=gs("Halt Requested");k[139]=gs("Unable to proceed, the website does not allow automated password change.");k[140]=gs("Timed out");k[141]=k[128];"function"==typeof alertfrombg&&(this.alert=alertfrombg);g_isfirefox&&(this.alert=alert);this.JSON=JSON;JSON||(this.JSON=LPJSON);this.get_pwchangestate=function(){return h};this.get_pwchangetabid=
function(){return x};this.get_login_url=function(a){return a?a.login_url:null};this.get_cpw_url=function(a){return a?a.cpw_url:null};this.get_acctmgmt_url=function(a){return a?a.acctmgmt_url:null};this.conditional_js_exec=function(a,b,d){return D(a,b,d)};this.show_cpwbot_overlay=function(a,b,d){return Xa(a,b,d)};this.in_validate=function(){return Z&&S&&null!=T&&""!=T&&"undefined"!=typeof T};this.in_validate_outer=function(){return oc.in_validate()||r||v};this.get_last_overlay_message=function(){return m_last_overlay_msg};
this.get_fakeui_loggedout_url=function(a){a=a?a.fakeui_loggedout_url:null;return a};this.get_fakeui_loggedin_url=function(a){a=a?a.fakeui_loggedin_url:null;return a};this.reveal_cpw=function(a,b){if(!b)return!1;var d=b.recipe,c=b.payload,e=c.aid;if(!d||!c)return!1;L("reveal_cpw called after wait-for-document-complete tabid="+a);CPWbot_bg.mark_timestamp("reveal_cpw");m(E,"Reveal Change-Password Form");h="D";ab=!1;D(a,d,Ab);var f=d?d.cpw_url:null;if(f)return L("call cpw:loadurl with "+f),e=null,g_CS_tops&&
(e=g_CS_tops[a],g_ischrome&&0!=e&&L("loadurl is not sending to docnum==0 ! "+e)),sendCS(a,{cmd:"loadurl",url:f},e),O=!0,verbose_log("m_in_loadurl set"),C=d,ja=c,ab=!0,null;ea=!1;if(c=M(d,FN_NAVIGATE_TO_CPW)){verbose_log("click on FN_NAVIGATE_TO_CPW field!");f=DEFAULT_CLICK_DELAY;"undefined"!=typeof d.cpw_delay&&(f=d.cpw_delay);ea=!0;L("now waiting for click_ack_D");var g=J(d);qa(a,c,f,g);CPWbot_bg.mark_timestamp("wait_for_click_ack_D")}c=!1;d?"undefined"!=typeof d.reveal_cpw_js_delay&&(c=d.reveal_cpw_js_delay?
!0:!1,"0"===d.reveal_cpw_js_delay&&(c=!1)):c=null;if(c&&(ab=!0,Zb(d)))return null;D(a,d,lb);if(b.didcallout)return L("end of reveal_cpw thread with callout to CS - hack Dpickup to resume for aid="+e),h="Dpickup",null;L("no callout to CS, so reveal_cpw does not end thread, returning to initiate");return!0};this.navigate_to_acctmgmt=function(a,b){if(!b)return!1;var d=b.recipe,c=b.payload,e=c.aid;L("navigate_to_acctmgmt called after wait-for-document-complete tabid="+a);CPWbot_bg.mark_timestamp("acctmgmt_nav");
h="C";if(!d)return!1;m(E,"Navigate to Account Management Page");bb=!1;D(a,d,Bb);var f=d?d.acctmgmt_url:null;if(f)return L("call acctmgmt:loadurl with "+f),e=null,g_CS_tops&&(e=g_CS_tops[a]),sendCS(a,{cmd:"loadurl",url:f},e),O=!0,verbose_log("m_in_loadurl set"),C=d,ja=c,bb=!0,null;ga=!1;if(c=M(d,FN_NAVIGATE_TO_ACCTMGMT)){verbose_log("click on FN_NAVIGATE_TO_ACCTMGMT field!");f=DEFAULT_CLICK_DELAY;"undefined"!=typeof d.acctmgmt_delay&&(f=d.acctmgmt_delay);ga=!0;L("now waiting for click_ack C");var g=
J(d);qa(a,c,f,g);CPWbot_bg.mark_timestamp("wait_for_click_ack_C")}c=!1;d?"undefined"!=typeof d.navigate_acctmgmt_js_delay&&(c=d.navigate_acctmgmt_js_delay?!0:!1,"0"===d.navigate_acctmgmt_js_delay&&(c=!1)):c=null;if(c&&(bb=!0,Yb(d)))return null;D(a,d,mb);if(b.didcallout)return L("end of navigate_to_acctmgmt thread with callout to CS - hack Cpickup to resume for aid="+e),h="Cpickup",null;g_v2engine||L("no callout to CS, so nav_to_acctmgmt does not end thread, returning to initiate");return!0};this.trigger_cpw=
function(a,b){if(hb)return!1;hb=!0;verbose_log("trigger_cpw entered");CPWbot_bg.mark_timestamp("trigger_cpw");if(!b)return!1;var d=b.recipe,c=b.payload;if(!d||!c)return!1;var e=Ua(d),f=Va(d);L("trigger_cpw called after wait-for-document-complete tabid="+a);h="E";var g=c.aid,k=za(g),w;if(k)w=k.url;else return ra("given invalid aid - data consistency error?"),!1;D(a,d,Cb);var N=M(d,FN_CURRENT_PASS),r=M(d,FN_NEW_PASS),q=M(d,FN_NEW_PASS_CONFIRM),y=M(d,FN_CPW_SUBMIT),n=J(d),A=15,v=1,p=1,u=1,x=0,B=1,H=
0,I=1,C=null;g_isfirefox?(LP.lpprefsHasUserValue("genpw_passlen")&&(A=LP.lpprefsGetIntPref("genpw_passlen")),LP.lpprefsHasUserValue("genpw_upper")&&(v=LP.lpprefsGetBoolPref("genpw_upper")?1:0),LP.lpprefsHasUserValue("genpw_lower")&&(p=LP.lpprefsGetBoolPref("genpw_lower")?1:0),LP.lpprefsHasUserValue("genpw_digits")&&(u=LP.lpprefsGetBoolPref("genpw_digits")?1:0),LP.lpprefsHasUserValue("genpw_special")&&(x=LP.lpprefsGetBoolPref("genpw_special")?1:0),LP.lpprefsHasUserValue("genpw_mindigits")&&(B=LP.lpprefsGetIntPref("genpw_mindigits")?
1:0),LP.lpprefsHasUserValue("genpw_ambig")&&(H=LP.lpprefsGetBoolPref("genpw_ambig")?1:0),LP.lpprefsHasUserValue("genpw_reqevery")&&(I=LP.lpprefsGetBoolPref("genpw_reqevery")?1:0),LP.lpprefsHasUserValue("genpw_pronounceable")&&(C=LP.lpprefsGetBoolPref("genpw_pronounceable")?1:0)):(A=parseInt(lpGetPref("generate_length",A)),v=parseInt(lpGetPref("generate_upper",v)),p=parseInt(lpGetPref("generate_lower",p)),u=parseInt(lpGetPref("generate_digits",u)),x=parseInt(lpGetPref("generate_special",x)),B=parseInt(lpGetPref("generate_mindigits",
B)),H=parseInt(lpGetPref("generate_ambig",H)),I=parseInt(lpGetPref("generate_reqevery",I)),C=parseInt(lpGetPref("generate_pronounceable",C)));0==v&&0==p&&0==u&&0==x&&(v=p=u=1);var F=getpasswordfromacct(k);F.length>A&&(A=F.length);var z=Xb(d);null!==z&&("undefined"!=typeof z.length&&null!==z.length&&(A=z.length),"undefined"!=typeof z.maxlength&&null!==z.maxlength&&A>z.maxlength&&(A=z.maxlength),"undefined"!=typeof z.minlength&&null!==z.minlength&&A<z.minlength&&(A=z.minlength),"undefined"!=typeof z.special&&
null!==z.special&&(x=z.special?1:0),"undefined"!=typeof z.digits&&null!==z.digits&&(u=z.digits?1:0),"undefined"!=typeof z.upper&&null!==z.upper&&(v=z.upper?1:0),"undefined"!=typeof z.lower&&null!==z.lower&&(p=z.lower?1:0),"undefined"!=typeof z.mindigits&&null!==z.mindigits&&(B=z.mindigits));m(E,"Generating a new password that is "+A+" chars long, "+(v?"with":"without")+" uppercase chars, "+(p?"with":"without")+" lowercase chars, "+(u?"with":"without")+" numeric chars, "+(x?"with":"without")+" special chars, with at least "+
B+" numbers,");A=(g_isfirefox?LP.lpCreatePass:lpCreatePass)(A,v,p,u,x,B,H,I,C);L("generated new password: "+(g_show_pw_in_logs||g_isadmin?A:"REDACTED"));L("saving "+(g_show_pw_in_logs||g_isadmin?A:"REDACTED")+" to "+w+" as generated password");g_isfirefox?ff_save_generated_password(A,w,!0,!0):savePassword(A,w,a,1);g_isfirefox?null!==LP.lpgenpwlist&&LP.lpgenpwlist.unshift(A):null!==g_genpws&&g_genpws.unshift(A);CPWbot_bg.do_milestone(a,73,d);c.newpw=lpenc_acct(A,k,"undefined"==typeof g_shares?lpshares:
g_shares);c.curpw=lpenc_acct(F,k,"undefined"==typeof g_shares?lpshares:g_shares);ja=c;wb=c.newpw;m(E,"Filling Change-Password Form");c=Ya(d);k=w=rnd2=rnd3=rnd4=0;N&&(k+=1,pa(a,F,N,e,c*k+w,f,n));r&&(k+=1,pa(a,A,r,e,c*k+w+rnd2,f,n));q&&(k+=1,pa(a,A,q,e,c*k+w+rnd2+rnd3,f,n));y&&(ha=!0,L("now waiting for click_ack E"),n=null,"undefined"!=typeof d.trigger_cpw_delay&&(n=d.trigger_cpw_delay),verbose_log("trigger cpw delay : "+n+" + "+c*k),e=null===n?c*k:n+c*k+rnd4,n=J(d),qa(a,y,e,n),CPWbot_bg.mark_timestamp("wait_for_click_ack_E"));
pass;D(a,d,Db);if(b.didcallout)return L("end of trigger_cpw thread with callout to CS - hack Epickup to resume for aid="+g),h="Epickup",null;L("no callout to CS, so trigger_cpw does not end thread, returning to initiate");return!0};this.navigate_to_login=function(a,b){if(!b)return!1;var d=b.recipe;h="B";$a=!1;if(!d)return!1;m(E,"Navigate to Login");var c=d?d.login_url:null;if(c){L("call login:loadurl with "+c);var e=null;g_CS_tops&&(e=g_CS_tops[a],g_ischrome&&0!=e&&L("loadurl is not sending to docnum==0 ! "+
e));sendCS(a,{cmd:"loadurl",url:c},e);O=!0;verbose_log("m_in_loadurl set");C=d;ja=b;$a=!0;return null}if(g_v2engine)return!1;c=!1;d?"undefined"!=typeof d.reveal_login_js_delay&&(c=d.reveal_login_js_delay?!0:!1):c=null;if(c&&($a=!0,sb(d)))return null;D(a,d,nb);return!0};this.check_is_logged_in=function(a,b,d){if(!b)return!1;b={recipe:b,desc:"validate_website_is_loggedin",fn_required:Uc,fn_rejected:Vc,fn_url_success:aa,fn_url_failed:aa};if(CPWbot_bg.should_wait_for_document_complete(a,b))r=!0,CPWbot_bg.wait_for_doc_complete(a,
null,da,b);else return L("validate_website_is_loggedin returns true, no wait "),!0;return null};this.validate_login_success=function(a,b,d){if(!b)return!1;D(a,b,Eb);b={recipe:b,desc:"validate_login_success",fn_required:Oc,fn_rejected:Pc,fn_url_success:Mb,fn_url_failed:Lb};if(CPWbot_bg.should_wait_for_document_complete(a,b))return r=!0,CPWbot_bg.wait_for_doc_complete(a,null,da,b),null;L("validate_login_success returns true, no wait ");return!0};this.validate_login_entry_success=function(a,b,d){if(!b)return!1;
D(a,b,Ac);b={recipe:b,desc:"validate_login_entry_success",fn_required:Qc,fn_rejected:Rc,fn_url_success:Ec,fn_url_failed:Dc};if(CPWbot_bg.should_wait_for_document_complete(a,b))return r=!0,CPWbot_bg.wait_for_doc_complete(a,null,da,b),null;L("validate_login_entry_success returns true, no wait ");return!0};this.validate_cpw_success=function(a,b,d){if(!b)return!1;D(a,b,Fb);b={recipe:b,desc:"validate_cpw_success",fn_required:Sc,fn_rejected:Tc,fn_url_success:Jb,fn_url_failed:Kb};if(CPWbot_bg.should_wait_for_document_complete(a,
b))r=!0,CPWbot_bg.wait_for_doc_complete(a,null,da,b);else return L("validate_cpw_success returns true, no wait "),!0;return null};this.validate_login_form=function(a,b,d){if(!b)return!1;b={recipe:b,desc:"validate_login_form",fn_required:Kc,fn_rejected:Lc,fn_url_success:aa,fn_url_failed:aa};if(CPWbot_bg.should_wait_for_document_complete(a,b))r=!0,CPWbot_bg.wait_for_doc_complete(a,null,da,b);else return L("validate_login_form returns true, no wait "),!0;return null};this.validate_cpw_form=function(a,
b,d){if(!b)return!1;b={recipe:b,desc:"validate_cpw_form",fn_required:Ic,fn_rejected:Jc,fn_url_success:aa,fn_url_failed:aa};if(CPWbot_bg.should_wait_for_document_complete(a,b))return r=!0,CPWbot_bg.wait_for_doc_complete(a,null,da,b),null;L("validate_cpw_form returns true, no wait ");return!0};this.validate_login_entry_form=function(a,b,d){if(!b)return!1;b={recipe:b,desc:"validate_login_entry_form",fn_required:Mc,fn_rejected:Nc,fn_url_success:aa,fn_url_failed:aa};if(CPWbot_bg.should_wait_for_document_complete(a,
b))r=!0,CPWbot_bg.wait_for_doc_complete(a,null,da,b);else return L("validate_login_entry_form returns true, no wait "),!0;return null};this.revert_password=function(a,b,d){if(!b)return!1;alert("REVERT: TODO");return!0};this.initiate=function(a,b,d,c){};this.cpwbot_cs_finish_complete=function(a){verbose_log("cpwbot_cs_finish_complete on tabid="+a);x!=a?null!==x&&verbose_log("stale call: started up a new password change on different tab - ABORT - tabid=="+a+" g_pwchangetabid="+x):(null!==CPWbot_bg.session_timeout_st_id&&
clearTimeout(CPWbot_bg.session_timeout_st_id),CPWbot_bg.session_timeout_st_id=null,null!==CPWbot_bg.docaptcha_si_id&&clearInterval(CPWbot_bg.docaptcha_si_id),CPWbot_bg.docaptcha_si_id=null,CPWbot_bg.mark_timestamp("finish_complete"),CPWbot_bg.logout(),Wb(a),CPWbot_bg.do_milestone(a,66,null))};this.finish_cpwbot_validate_state=function(a,b,d,c,e){verbose_log("ENTERED finish_cpwbot_validate_state");var f=!1,g=!1;if(x!=a)return verbose_log("finish_cpwbot_validate_state: !tabid, abort"),!1;if(b!=S)return verbose_log("finish_cpwbot_validate_state: ignoring stale request, current validate is "+
T+"/"+S+", stale req is "+e+"/"+b+" "),!1;var k=Wa(C),w=S;if(ua&&!Ea)return ua=!1,Ea=!0,L("finish_cpwbot_validate_state: reload1 extending timeout for "+e),setTimeout(function(){CPWbot_bg.finish_cpwbot_validate_state(a,w,d,c,e)},k),!1;verbose_log("finish_cpwbot_validate_state: closing out request "+e+"/"+b);if(null===F)return verbose_log("finish_cpwbot_validate_state: dup, abort"),!1;if(null===g_CS[a])return lploggedin?(L("finish_cpwbot_validate_state: reload2 extending timeout for "+e),setTimeout(function(){CPWbot_bg.finish_cpwbot_validate_state(a,
w,d,c,e)},k)):(verbose_log("finish_cpwbot_validate_state: tab "+a+" closed "),CPWbot_bg.panic("logged out?")),!1;k=rb;g_CS[a].length==F.length&&(g=!0);for(b=0;b<F.length;b++)if(F[b]){f=!0;break}g||verbose_log("finish_cpwbot_validate_state: sent out "+g_CS[a].length+" messages, received "+F.length+" messages, skipped "+k+" frames");b=g=0;for(var m in n)n.hasOwnProperty(m)&&!this.skip_frame_by_score(m)&&(g++,F[m]&&b++);b<g&&console_warn("CASE : still waiting to hear from important frames, expected to hear from "+
g+", heard from "+b);f||(m=JSON.parse(d),g=JSON.parse(c),0==m.length&&0<g.length&&(f=!0));Z=F=null;rb=0;g_v2engine?(v=r=!1,L("VALIDATE_IN_DOCWAIT=false"),Q=f,y={},console_log("finish_cpwbot_validate_state complete result="+f+", wait for next engine cycle at "+h),pass):(f={aid:ca,recipe:C,validate_result:f},console_log("finish_cpwbot_validate_state resumed initiate with state="+h),CPWbot_bg.initiate(a,f,h));return!1};this.chk_cpw_resume=function(a,b){return!1};this.cpwbot_validate_state_result_handler=
function(a,b){var d=!1;if(CPWbot_bg&&null!==x&&a==x){var c=b.docnum;if("undefined"!=typeof c&&CPWbot_bg&&null!==F){var e=JSON.parse(b.result);JSON.parse(b.rejected_fields);JSON.parse(b.required_fields);var f=!1,g=null;b.result_obj&&(g=JSON.parse(b.result_obj));var k=b.desc,w=b.id;L("received a "+k+" validate result from ["+a+"]["+c+"]["+b.url+"]["+b.docstate+"]["+b.state+"]="+e);if(T&&T!=k||S&&S!=w)L("unexpected validate msg - perhaps from the last validate call.... ignoring it"),L("got "+k+"/"+w+
" expected "+T+"/"+S);else{w=!1;if(g){b.required_url&&m(P,"["+a+"]["+c+"] validate given success_url, result="+g.url_success_match+" when matching success url = "+b.required_url);b.rejected_url&&m(P,"["+a+"]["+c+"] validate given bad_url, result="+g.url_failure_match+" when matching failure url = "+b.rejected_url);m(P,sprintf("[%s][%d] %s found %d/%d success fields, given %d invalid fields and %s invalid fields, %s captcha-ish fields",a,c,k,g.num_ok_matches,g.num_okfields,g.num_badfields,g.found_bad_match?
"found":"did not find",g.found_interactive?"found":"did not find"));if(0<g.num_ok_matches)fc(a,b),g.found_interactive&&(w=!0);else if(g.found_bad_match)fc(a,b),w=!0;else{var q=b.docnum,p=b.url;null!==n&&(null!==n[q]&&"undefined"!=typeof n[q]||CPWbot_bg.clear_frame_score(a,q,p),n[q]+=-2)}g.found_interactive&&(f=!0)}F[c]=e;c=Sb(a);if(null===g_CS[a]&&CPWbot_bg&&Z)L("interrupted by a page load/refresh, reissuing validate for state "+h),F=[],sendCS(a,Z,"all");else if(g_CS[a]&&g_CS[a].length==F.length&&
(d=!0),null===g_CS[a]?verbose_log("tab is reloading but cannot retry validate ? WTF"):verbose_log("["+a+"] "+k+" sent "+g_CS[a].length+" messages, heard from "+F.length+", skipped "+c+" frames"),e||d||w||f)F=null,null===e&&(e=!1),Z=null,v=r=!1,L("VALIDATE_IN_DOCWAIT=false"),L("validate complete, result is "+e+" current state="+h),Q=e,y=g}}else debug&&L("stale2? validate result tabid="+a+" g_pwchangetabid="+x+" g_pwchange_validate_desc="+T)}else debug&&L("stale1? validate result tabid="+a+" g_pwchangetabid="+
x+" g_pwchange_validate_desc="+T)};this.cpwbot_finish_ack_handler=function(a,b){if(null!==a&&b){sendCS(a,{cmd:"cpwbot_finish_ack"},"all");sendCS(a,{cmd:"hide_cpwbot_overlay"},"all");if(g_CS_tops[a]!=b.docnum)if(null==g_CS_tops[a]||"undefined"==typeof g_CS_tops[a])console_error("webpage has not finished loading");else{console_error("WTF : top "+g_CS_tops[a]+" but docnum is "+b.docnum);var d=getcsinfo(a,b.docnum),c=getcsinfo(a,g_CS_tops[a]);c&&verbose_log("["+g_CS_tops[a]+"] topdoc is "+c.url);d&&verbose_log("["+
b.docnum+"] other doc is "+d.url);d&&d.parent_docnum==d.docnum?verbose_log("CS table says that "+b.docnum+" is top"):c&&c.parent_docnum==c.docnum?verbose_log("CS table says that "+g_CS_tops[a]+" is top"):verbose_log("CS table mismatch, or reloading ? ")}CPWbot_bg.cpwbot_cs_finish_complete(a)}};this.cpwbot_skip_url=function(a,b){return!1};this.destination_tab=this.originating_tab=this.destination_tabid=this.originating_tabid=null;this.logout=function(){S=T=Z=ja=C=ca=h=null;pc=0;wb=x=null;g();Fa=Ga=
!1;n=null;Ea=ua=!1;xa=null;this.clear_event_queue();ta=ha=na=ea=ga=ma=va=!1};this.initialize=function(a){a?(x=a.tabid,debug&&(qc=a.tabid),C=a.recipe,ca=a.aid,h=0,g(),Ga=ha=Fa=!1,g_robots_txt&&sendCS(a.tabid,{cmd:"get_robots_txt"},g_CS_tops[a.tabid]),n={},Ea=ua=!1,xa=null,Ha="",gb=wa=fb=eb=db=yb=xb=!1,ib=0,CPWbot_bg.clear_event_queue(),V=1,ec(),hb=!1,CPWbot_bg.broken_hearted_st_id=null,ya=Ca=Ia=O=!1,this.cpw_dialog_minimize_state=Sa=0):console_error("passed invalid params")};this.pwchangetabid_is_still_valid=
function(){if(!CPWbot_bg)return!1;var a=x;return null!==a&&g_CS&&"undefined"!=typeof g_CS[a]&&null!==g_CS[a]?!0:!1};this.panic=function(a){a||(a="UNEXPECTED ERROR");L("panic="+a+", g_pwchangetabid == "+x);CPWbot_bg.do_milestone(x,128,C,a);B(x);CPWbot_bg.cpwbot_cs_finish_complete(x)};this.setmsg_cpwbot_overlay=function(a,b){Xa(a,b)};this.initiate_on_complete=function(a,b,d){var c=null;if(!g_cpwbot||!CPWbot_bg||45<d)return CPWbot_bg.do_milestone(a,133,f,"initiate_on_complete"),CPWbot_bg.panic("TIMEOUT-initiate"),
null;var e=b.aid,f=b.recipe;if("undefined"==typeof d||null===d)d=1;if(!cc(f)){var c=za(e),g="(null)";c&&c.url&&(g=this.JSON.stringify(c.url));m(Za,"Bad Recipe");e="Error for recipe on aid="+e+", url="+g;CPWbot_bg.phone_home(null,null,{severity:"fatal",msg:"Bad Recipe"});CPWbot_bg.panic(e);return null}if(Da)nc(a,f);else{(f=ac(f))||(f=900);var h=g_CS_tops[a];if(null!==h&&(c=getcsinfo(a,g_CS_tops[a]))&&"complete"==c.docstate)return CPWbot_bg.mark_timestamp("doc_complete"),ping(a),c=d?d*f/1E3:0,isNaN(c)&&
verbose_log("WTF NaN: ctr="+d+" url="+g+" aid="+e),p&&(e=p.doc_complete-p.openurl_callback,0<e&&0!=p.doc_complete&&p.openurl_callback&&(c=e/1E3)),0<c&&m(P,"Waited "+c+" seconds for document-complete before calling initialize_engine"),CPWbot_bg.initialize_engine(a,b);if(Da||!lploggedin)return L("abort wait-for-doc-complete initiate"),!1;null!==h?ping(a,h):ping(a);verbose_log("waiting for tabid "+a+" topdocnum="+h+" docstate="+(c?c.docstate:"null"));setTimeout(function(){CPWbot_bg.initiate_on_complete(a,
b,d+1)},f);return!0}};this.get_user_debug_messages=function(a,b){return vb};var P=0,E=1,fd=2,Za=3;this.userlog=function(a,b){return m(a,b)};this.click_ack_handler=function(a,b){var d=b.msgid,c=b.found;L("[T:"+a+"][D:"+b.docnum+"] cpwbot click_ack on "+b.id_value+" found="+c+" url="+b.url+" docstate="+b.docstate+" pwchangestate="+b.pwchangestate);if(xa!=d)return console_error("response for last click request overlaps current click-wait, ignoring it, found="+c),L("m_pwchange_last_click_field_id="+xa),
L("found="+c+" msgid = "+d),c&&console_error("Bad Mojo"),!0;c&&(ha&&(ha=!1),sa&&(sa=!1),ea&&(ea=!1),ga&&(ga=!1),va&&(va=!1),ma&&(ma=!1),na&&(na=!1),ta&&(ta=!1));return!0};this.fill_ack_handler=function(a,b){verbose_log(sprintf("[%s][%s] cpwbot fill ack on %s found=%s docstate=%s url=%s req_id=%s",a,b.docnum,b.id_value,b.found,b.docstate?b.docstate:"null",b.url?b.url:"null",b.req_id?b.req_id:"null"));return!0};this.js_ack_handler=function(a,b){var d="";try{d=JSON.parse(b.result)}catch(c){console_warn("js_ack_handler: "+
c)}verbose_log(sprintf("[%s][%s] cpwbot js ack result=%s docstate=%s url=%s req_id=%s",a,b.docnum,d?ofa(d):"null",b.docstate?b.docstate:"null",b.url?b.url:"null",b.req_id?b.req_id:"null"));return!0};this.check_for_robots=function(a,b,d){};this.check_robot_txt=function(a,b,d){if(g_robots_txt){if(!a)return!0;if(null===b)g_tmp_recipe=a;else{d=b.split("\n");var c=!1,e=!1;for(b=0;b<d.length;b++){a=d[b];if(0==a.length&&""==a||"\r"==a)e=c=!1;"#"!=a.charAt(0)&&(0==a.indexOf("User-agent: LastPass")?c=!0:0==
a.indexOf("User-agent: *")?c=!0:0==a.indexOf("Disallow: /")&&(e=!0))}return c&&e?!1:!0}}};this.score_frame=function(a,b){var d=b.docnum,c=b.url,e,f=0,g=lp_gettld_url(c),h=0,k="doubleclick.net appads.com crwdcntrl.net googleadservices.com quantserve.com questionmarket.com advertising.com zedo.com checkm8.com zvents.com doubleclick.com yldmgrimg.net optmd.com casalemedia.com scorecardresearch.com quotemedia.com tacoda.net daylife.com brightcove.com wibiya.com clickability.com stats.com google-analytics.com adfusion.com 2mdn.net adsonar.com everyclick.com shopica.com yeah.com vectorportal.com cnomy.com phpbb.com tracking101.com revsci.net revsci.com atdmt.com mmismm.com googlesyndication.com 247realmedia.com pointroll.com bluekai.com serving-sys.com vizu.com cleanprint.com outbrain.com tweetmeme.com visiblemeasures.com starwave.com kaango.com gabriels.net overture.com yieldmanager.net 2mdn.com eyewonder.com imgdownloads.com liverail.com adnxs.com addthis.com addthiscdn.com imshopping.com adtech.de 2o7.net glanceguide.com performgroup.com undertone.com undertonevideo.com martiniadnetwork.com chartbeat.net omtrdc.net zoomflow.com crowdscience.com imrworldwide.com fwmrm.net tremormedia.com webtrends.com adzerk.net adzerk.com qubitproducts.com maxymiser.net maxymiser.com newrelic.com mathtag.com adroll.com criteo.com liveperson.com getclicky.com sitemeter.com displaymarketplace.com yieldmanager.com media6degrees.com betrad.com 360yield.com adpredictive.com burstnet.com adtechus.com adsafeprotected.com turn.com contextweb.com p-td.com lijit.com rubiconproject.com ru4.com admeld.com openx.net pubmatic.com localyokelmedia.com qnsr.com wrating.com audienceiq.com mydas.mobi mopub.com visualrevenue.com adsymptotic.com admob.com adtrking.com 4dsply.com adshostnet.com adziff.com 33across.com vindicosuite.com securepaths.com taboola.com trk4.com crwdcntrl.com connexity.com connexity.net effectivemeasure.net visualdna.com amazon-adsystem.com 4dsply.com adblade.com doubleverify.com technoratimedia.com adjuggler.com opbandit.com iesnare.com adexcite.com adadvisor.net agkn.com dntx.com revenuehits.com tribalfusion.com".split(" "),
m="ads.cnn.com metrics.post-gazette.com ads.nwsource.com adbox.sina.com.cn ads.sina.com.cn ad.afy11.net avatar.cnn.com ads.cnn.com metrics.apple.com trailers.apple.com metrics.philly.com adsatt.espn.go.com player.ooyala.com seg.sharethis.com edge.sharethis.com bender.spoutable.com engine.spoutable.com".split(" "),q="facebook.com/plugins facebook.com/connect/xd_arbiter youtube.com/embed/ platform.twitter.com/widget platform.twitter.com/tweet_button libsyn.com/embed amazon.com/gp/widget".split(" ");
g_CS_tops&&g_CS_tops[a]==b.docnum&&(f=100);for(e=0;e<k.length;e++)if(g==k[e]){f=-100;h=1;break}if(!h)for(e=0;e<m.length;e++)if(0<=c.indexOf(m[e])){f=-100;h=1;break}if(!h)for(e=0;e<q.length;e++)if(0<=c.indexOf(q[e])){f=-100;break}n&&(n[d]=f);return f};this.score_topdoc=function(a,b,d){if(null===n)return!1;null!==n[b]&&"undefined"!=typeof n[b]||CPWbot_bg.clear_frame_score(a,b,d);if((a=getcsinfo(a,b))&&(state_param=a.flags)&&state_param.has_frameset)return!0;n[b]+=100;return!0};this.clear_frame_score=
function(a,b,d){if(null===n)return!1;n[b]=0;return!0};this.reset_scores=function(a){n=null;return!0};this.skip_frame_by_score=function(a){if(null===n||null===a)return!0;L("skip? docnum ="+a+" score="+n[a]);return 0>n[a]};this.recompute_scores_for_tab=function(a){return!0};this.retry_validate=function(a,b){null===b&&(b="all");Z&&(F=[],sendCS(a,Z,b))};this.wait_for_doc_complete=function(a,b,d,c,e,f){function g(a){return n?"complete"==a||"interactive"==a:"complete"==a}var k,q=c.aid,fa=null,n=Vb(c.recipe);
e||(e=0);var r=ac(c.recipe);r||(r=900);var p=g_CS_tops[a];"undefined"==typeof p&&(p=null);if(null===b||"undefined"==typeof b)b=p;if(null!==b&&(k=getcsinfo(a,b))&&(fa=k.docstate,g(k.docstate)&&g(f)))return f=e?e*r/1E3:0,isNaN(f)&&verbose_log("WTF NaN: recursion_ctr="+e+" aid="+q),0<f&&m(P,sprintf("Waited %d seconds for %s on [tabid:%s][docnum:%d] to execute %s",f,n?"interactive":"complete",a,b,c.desc)),null!==CPWbot_bg.get_pwchangetabid()&&CPWbot_bg.in_validate()&&(v=!1,L("WAITED DONE, calling "+c.desc+
" VALIDATE_IN_DOCWAIT=false")),d(a,c);if(Da||!lploggedin||null===h)return L("abort wait-for-doc-complete "+c.desc),!1;ping(a);verbose_log("waiting for tabid "+a+" topdocnum="+p+" passed_docnum="+b+" docstate="+(k?k.docstate:"null")+" last_state="+f);b!=p&&(console_error("edge case - top docnum changed due to page reload?  will wait for that instead"+b+"!="+p),b=p);setTimeout(function(){lploggedin&&CPWbot_bg&&CPWbot_bg.wait_for_doc_complete(a,b,d,c,e+1,fa)},r);return!0};this.should_wait_for_document_complete=
function(a,b){if(null===a||!b)return!1;var d=b.desc,c=b.recipe,e=!0,f=b.fn_url_failed,g=b.fn_url_success,h=b.fn_required,k=b.fn_rejected,h=h?h(c):[],c=k?k(c):[],k=b.target_url,m=b.target_field,q=b.target_js;if("undefined"!=typeof k&&null!==k||"undefined"!=typeof m&&null!==m||"undefined"!=typeof q&&null!==q)e=!1;if(e){if(0==h.length&&0==c.length&&!g&&!f)return L("should_wait returns false, WARN: "+d+" has no field or url criteria defined to validate against"),!1}else if(!k&&!m&&!q)return L("should_wait returns false, no wait criteria, "+
d),!1;L("should_wait returns true for "+d+" is_validate="+e);return!0};this.handle_challenge=function(a,b){};this.validate_challenge_page=function(a,b,d){if(!b)return!1;b={recipe:b,desc:"validate_challenge_form",fn_required:Wc,fn_rejected:Xc,fn_url_success:Gc,fn_url_failed:Fc};if(CPWbot_bg.should_wait_for_document_complete(a,b))r=!0,CPWbot_bg.wait_for_doc_complete(a,null,da,b);else return L("validate_challenge_form returns false, no criteria to check, no wait"),!1;return null};this.force_validate_retry=
function(a){ua=a};this.validate_challenge_success=function(a,b,d){if(!b)return!1;D(a,b,wc);b={recipe:b,desc:"validate_challenge_success",fn_required:Yc,fn_rejected:Zc,fn_url_success:aa,fn_url_failed:aa};if(CPWbot_bg.should_wait_for_document_complete(a,b))r=!0,CPWbot_bg.wait_for_doc_complete(a,null,da,b);else return L("validate_challenge_success returns true, no wait "),!0;return null};var Ha="";this.set_dialog_msg=function(a){Ha=a;return!0};this.get_dialog_msg=function(){return Ha};this.clear_dialog_msg=
function(){Ha="";return!0};this.get_failstate=function(){return db};this.get_okstate=function(){return eb};this.get_captchastate=function(){return fb};this.get_docaptchastate=function(){return wa};this.get_brokenheartstate=function(){return gb};this.get_failpwsavedstate=function(){return Ja};this.get_fail_pending=function(){return Fa};this.get_success_pending=function(){return Ga};this.show_selenium_ok=function(a){gc(a,"OK")};this.show_selenium_fail=function(a){gc(a,"FAIL")};this.preinit=function(){h=
"preinit";g();vb=Ha="";null!==CPWbot_bg.broken_hearted_st_id&&clearTimeout(CPWbot_bg.broken_hearted_st_id);CPWbot_bg.broken_hearted_st_id=null;Ja=eb=gb=db=wa=fb=Da=!1};this.do_milestone=function(a,b,d,c){var e=null;d||(d={symbolic:""});if("undefined"==typeof c||null===c)c="";if("undefined"!=typeof Date){var f="",g=(new Date).toString();k[b]&&((e=U(d))||(e=gs("unnamed site")),e=sprintf(k[b],e));switch(b){case 1:case 2:break;case 3:case 8:break;case 4:verbose_log("C: GOTO ACCTMGMT ");break;case 5:verbose_log("D: REVEAL");
break;case 6:verbose_log("E: TRIGGER");break;case 7:verbose_log("F: VALIDATE");break;case 9:Ta(a,d,ja);D(a,d,Bc);wa=!0;g_isfirefox&&Xa(a,gs("The website needs you to enter information. Please close this overlay and enter it."),d,!0);Wb(a);CPWbot_bg.session_timeout_st_id&&(clearTimeout(CPWbot_bg.session_timeout_st_id),CPWbot_bg.session_timeout_st_id=null);CPWbot_bg.docaptcha_si_id&&clearInterval(CPWbot_bg.docaptcha_si_id);CPWbot_bg.docaptcha_si_id=setInterval(function(){wa&&da(a,{desc:"docaptcha",
recipe:d,fn_required:Rb})},1E3);break;case 63:m(E,"Saved and Replaced");eb=!0;if(debug||g_isdebug)m(E,"showing selenium ok result"),CPWbot_bg.show_selenium_ok(a);Ga=!0;CPWbot_bg.mark_timestamp("success");break;case 65:g_v2engine?m(E,sprintf("[%s] v2 %s",g,gs("BEGIN"))):m(E,sprintf("[%s] %s",g,gs("BEGIN")));break;case 66:g_v2engine?m(E,sprintf("[%s] v2 %s",g,gs("End").toUpperCase())):m(E,sprintf("[%s] %s",g,gs("End").toUpperCase()));break;case 67:verbose_log("USER IS ALREADY LOGGED IN, SKIP LOGIN STATE");
m(E,"Appears to be Logged Into Site");break;case 75:case 68:m(E,"Filling Login Form");break;case 74:case 69:m(E,"Submit Login Form");break;case 70:m(E,"Going to Login");verbose_log("B: GOTO LOGIN");break;case 71:m(E,"Perform Logout");break;case 72:1!=V&&m(E,sprintf("Adjusting for %s site, %6.2f",1<V?"slow":"fast",V));break;case 73:Ja=!0;m(E,"Generated Random Password and Saved to Vault");break;case 128:f="UNEXPECTED ERROR";break;case 131:f="FILL LOGIN FORM [PW CHALLENGE] FAILED!";break;case 132:f=
"SUBMIT LOGIN FORM [PW CHALLENGE] FAILED!";break;case 134:f="Expected Change-Password Form";break;case 135:f="Change Password Failed";break;case 130:f="Expected Login Form";break;case 129:case 141:f="Login to Website Failed!";break;case 136:f="Unable to Save New Password";break;case 137:f="Unable to Log Out of Website";break;case 133:f=gs("Timed out waiting for the page to load.  Retry?");gb=!0;break;case 140:f="Session Timeout";break;case 138:f="Halt Requested";break;case 139:fb=!0;f="Interaction required; cannot proceed";
break;default:e=""}if(128==(b&128)){db=!0;m(Za,f);if(debug||g_isdebug)m(E,"showing selenium fail result"),CPWbot_bg.show_selenium_fail(a);Fa=!0;CPWbot_bg.mark_timestamp("fail");c={severity:"fatal",msg:sprintf("%s[debug=%s]",f,c)};CPWbot_bg.phone_home(a,d,c);Ja&&(e=sprintf(k[248],U(d)))}else 64==(b&64)&&(e="");e&&(Xa(a,e,d),CPWbot_bg.set_dialog_msg(e));CPWbatch&&CPWbatch.cpw_get_batchjob_state();CPWbatch&&CPWbatch.conditional_website_status_update({tabid:a,recipe:d,state:b,msg:e});return!0}};var rc=
null,ka=null,qb=null,r=!1,r=!1,ib=0,oa=[],O=!1,Ia=!1,Ca=!1,ya=!1,jb=!1,Ka=!1,La=!1,Ma=!1,Na=!1,Oa=!1,Pa=!1,v=null,Q=null,y={},W=null,Tb=null,Ub=null,qc=null,Ob=null,ob=null,Sa=0,zb=null,Da=!1,Ja=!1;this.docaptcha_si_id=this.session_timeout_st_id=this.broken_hearted_st_id=null;this.engine=function(a,b,d){var c;function e(a){debug&&(a=sprintf("[%s][%s] : %s",(new Date).toString(),"engine",a),console_log(a))}function f(a,b,d){var c;c={aid:d.aid,recipe:d.recipe};verbose_log("do_C "+h);CPWbot_bg.do_milestone(a,
4,b);c={desc:"navigate_to_acctmgmt",didcallout:!1,payload:c,recipe:b,target_field:M(b,FN_NAVIGATE_TO_ACCTMGMT),target_js:Bb(b)+""+mb(b),target_url:b?b.acctmgmt_url:null};CPWbot_bg.should_wait_for_document_complete(a,c)?(L("wrapped navigate_to_acctmgmt around wait-for-document-complete"),Ca=c.didcallout=!0,CPWbot_bg.wait_for_doc_complete(a,null,function(a,b){L("Cnav milestone");h="Cnav";W=b},c),c=null):(c.didcallout=!1,L("execute navigate_to_acctmgmt, no wait "),c=CPWbot_bg.navigate_to_acctmgmt(a,
c));if(null===c)return L("callout to CS : navigate_to_acctmgmt"),c;!1===c&&console_error("C error");L("execute navigate_to_acctmgmt, no wait ");return k(a,b,d)}function g(a,b,d){I=!1;var c=Yb(b);c||(c=2500);if(c&&!Ma)return h="Csleep",L("C sleeping "+c),I=!0,ka=ba+c,Ma=!0,null;Ma=!0;bb&&D(a,b,mb);return k(a,b,d)}function k(a,b,d){verbose_log("do_D "+h);var c;c={aid:d.aid,recipe:d.recipe};ya=!1;CPWbot_bg.do_milestone(a,5,b);c={desc:"reveal_cpw",payload:c,recipe:b,didcallout:!1,target_field:M(b,FN_NAVIGATE_TO_CPW),
target_js:Ab(b)+""+lb(b),target_url:b?b.cpw_url:null};CPWbot_bg.should_wait_for_document_complete(a,c)?(L("wrapped reveal_cpw around wait-for-document-complete"),ya=c.didcallout=!0,CPWbot_bg.wait_for_doc_complete(a,null,function(a,b){L("Dreveal milestone");h="Dreveal";W=b},c),c=null):(c.didcallout=!1,L("execute reveal_cpw, no wait "),c=CPWbot_bg.reveal_cpw(a,c));if(c)return L("execute reveal_cpw, no wait "),n(a,b,d);L("callout to CS : reveal_cpw");return c}function m(a,b,d){I=!1;var c=Zb(b);c||(c=
2500);if(c&&!Na)return h="Dsleep",L("D sleeping "+c),I=!0,ka=ba+c,Na=!0,null;Na=!0;ab&&D(a,b,lb);L("entered do_D1");c={aid:d.aid,recipe:b};h="D1";c=CPWbot_bg.validate_cpw_form(a,b,c);null===c?(verbose_log("D1: validate_cpw_form / CS callout "),v=!0,L("VALIDATE_IN_DOCWAIT=true"),a=null):a=c?void 0:q(a,b,d);return a}function q(a,b,d){var c={aid:d.aid,recipe:b};h="D2";if(null===CPWbot_bg.validate_login_form(a,b,c))return v=!0,L("VALIDATE_IN_DOCWAIT=true"),verbose_log("D2: validate_login_form / CS callout "),
null;if(ca)return p(a,b,d);CPWbot_bg.do_milestone(a,134,b,"");B(a);return!1}function p(a,b,d){h="D4";verbose_log("D4: FILL LOGIN/CHALLENGE");if(!Ta(a,b,R))return CPWbot_bg.do_milestone(a,131,b,""),B(a),!1;verbose_log("D5: SUBMIT LOGIN");h="D5";var c=1100,e=tb(b);e&&(c=e);c&&verbose_log("waiting "+c+" ms after login waiting for site to bootstrap");e=pb(a,b,R);!1===e?(CPWbot_bg.do_milestone(a,132,b,""),B(a),a=!1):null===e?(c&&(I=!0,ka=ba+c),a=null):a=n(a,b,d);return a}function n(a,b,d){verbose_log("do_E "+
h);var c;c={aid:d.aid,recipe:d.recipe};CPWbot_bg.do_milestone(a,6,b);c={desc:"trigger_cpw",payload:c,recipe:b,target_field:M(b,FN_CPW_SUBMIT),target_js:Cb(b)+""+Db(b),target_url:null};CPWbot_bg.should_wait_for_document_complete(a,c)?(L("wrapped trigger_cpw around wait-for-document-complete"),Ia=c.didcallout=!0,CPWbot_bg.wait_for_doc_complete(a,null,function(a,b){L("Etrigger milestone");h="Etrigger";W=b},c),c=null):(c.didcallout=!1,L("execute trigger_cpw, no wait "),c=CPWbot_bg.trigger_cpw(a,c));if(c)return L("execute trigger_cpw, no wait "),
u(a,b,d);L("callout to CS : trigger_cpw");return c}function u(a,b,d){I=!1;var c;c=0;b?"undefined"!=typeof b.posttrigger_sleep&&(c=b.posttrigger_sleep):c=null;c||(c=2500);if(c&&!Oa)return h="Esleep",L("E sleeping "+c),I=!0,ka=ba+c,Oa=!0,null;Oa=!0;d.validate_result=null;CPWbot_bg.mark_timestamp("verify_cpw");CPWbot_bg.do_milestone(a,7,b);h="F";null===CPWbot_bg.validate_cpw_success(a,b,R)?(verbose_log("F: VALIDATE callout to CS"),v=!0,L("VALIDATE_IN_DOCWAIT=true"),a=null):(verbose_log("F: VALIDATE no callout to CS"),
ic("no verify-cpw criteria defined"),CPWbot_bg.panic("fail"),a=!1);return a}function x(a,b,d){if(Gb(b)){d=1234;var c=cd(b);c&&(d=c);setTimeout(function(){CPWbot_bg.conditional_js_exec(a,b,Gb)},d)}console_error("The End.");return!0}function A(a,b,d){CPWbot_bg.do_milestone(a,3,b);var c=kb(b);return c?(h="A3R",verbose_log("A3R: login-form-reveal"),d=DEFAULT_CLICK_DELAY,"undefined"!=typeof b.login_reveal_delay&&(d=b.login_reveal_delay),va=!0,L("now waiting for click_ack A3R"),b=J(b),qa(a,c,d,b),CPWbot_bg.mark_timestamp("wait_for_click_ack_A3R"),
null):E(a,b,d)}function E(a,b,d){L("post_A3R");I=!1;var c=sb(b);verbose_log("A3R sleepval="+c);c||(c=1E3);if(c&&!Ka)return h="A3Rsleep",L("A3R sleeping "+c),I=!0,ka=ba+c,Ka=!0,null;Ka=!0;d.validate_result=null;verbose_log("calling reveal JS after A3 state");D(a,b,nb);return C(a,b,d)}function C(a,b,d){CPWbot_bg.do_milestone(a,3,b);var c=!0;"undefined"!=typeof d.check_login_entry_form&&(c=d.check_login_entry_form?!0:!1);h="A3";if(c){var c=[],e=[FN_LOGIN_ENTRY_USERNAME,FN_LOGIN_ENTRY_PASSWORD,FN_LOGIN_ENTRY_SUBMIT],
f;for(f=0;f<e.length;f++){var g=H(b,e[f]);g&&0<g.length&&(c=c.concat(g))}}if(c){verbose_log("M: validate_login_entry_form");CPWbot_bg.mark_timestamp("login_entry");h="M";verbose_log("calling validate_login_entry_form");c=CPWbot_bg.validate_login_entry_form(a,b,R);if(null===c)return verbose_log("M: validate_login_entry_form / CS callout "),v=!0,L("VALIDATE_IN_DOCWAIT=true"),null;verbose_log("M: validate_login_entry_form returns "+c+" no call to CS")}verbose_log("A3: validate_login_form");h="A3";verbose_log("calling validate_login_form");
c=CPWbot_bg.validate_login_form(a,b,R);if(null===c)return verbose_log("A3: validate_login_form / CS callout "),v=!0,L("VALIDATE_IN_DOCWAIT=true"),null;verbose_log("A3: validate_login_form returns "+c+" no call to CS");return c?F(a,b,d):P(a,b,d)}function F(a,b,d){CPWbot_bg.mark_timestamp("login_cpw");verbose_log("A4: FILL LOGIN");h="A4";if(!Ta(a,b,R))return CPWbot_bg.do_milestone(a,130,b,""),B(a),!1;verbose_log("A5: SUBMIT LOGIN");h="A5";var c=1100,e=tb(b);e&&(c=e);c&&verbose_log("waiting "+c+" ms after login waiting for site to bootstrap");
e=pb(a,b,R);!1===e?(CPWbot_bg.do_milestone(a,129,b,""),B(a),a=!1):null===e?(c&&(I=!0,ka=ba+c),a=null):a=K(a,b,d);return a}function K(a,b,d){verbose_log("A2: validate_login_success ");h="A2";var c=null,c=CPWbot_bg.validate_login_success(a,b,R);if(null===c)return verbose_log("A2: validate_login_success / CS callout "),v=!0,L("VALIDATE_IN_DOCWAIT=true"),null;verbose_log("A2: validate_login_success "+c+" no CS callout ");if(c)g_cpw_do_fakeui?(b&&d&&null!==a&&g_cpw_do_fakeui&&(h="FKLL0",verbose_log("entered do_logged_in_fake_ui")),
c=Ya(b),setTimeout(function(){f(a,b,d)},0*c+1021)):f(a,b,d);else return CPWbot_bg.do_milestone(a,129,b,X),B(a),retval}function P(a,b,c){CPWbot_bg.mark_timestamp("navlogin_cpw");pc++;CPWbot_bg.do_milestone(a,70,b);CPWbot_bg.navigate_to_login(a,{aid:c.aid,recipe:c.recipe})&&U(a,b,c)}function aa(a,b,c){ma=!1;var d=kb(b);if(d)return h="B1R",verbose_log("B1R: login-form-reveal"),verbose_log("click on FN_REVEAL_LOGIN field!"),c=DEFAULT_CLICK_DELAY,"undefined"!=typeof b.login_reveal_delay&&(c=b.login_reveal_delay),
ma=!0,verbose_log("now waiting for click_ack B1R"),b=J(b),qa(a,d,c,b),CPWbot_bg.mark_timestamp("wait_for_click_ack_B1R"),null;jc(a,b,c)}function U(a,b,c){verbose_log("post_B");I=!1;var d=sb(b);d||(d=1E3);if(d&&!La)h="Bsleep",L("B sleeping "+d),I=!0,ka=ba+d,La=!0;else{La=!0;c.desc="post_B/Breveal";c.validate_result=null;if(g_v2engine||$a)verbose_log("calling reveal JS after B state"),D(a,b,nb);jb=!0;CPWbot_bg.wait_for_doc_complete(a,null,function(a,b){L("B-reveal milestone");h="B1Rpre";W=b},c)}}function ua(a,
b,c){h="A1";c=CPWbot_bg.check_is_logged_in(a,b,c);null===c?(verbose_log("A1: check_is_logged_in / CS callout "),v=!0,L("VALIDATE_IN_DOCWAIT=true")):(verbose_log("A1: check_is_logged_in returns "+c+" no CS callout "),(c=la=Q)?pa(a,b,d):A(a,b,d))}function pa(a,b,c){CPWbot_bg.do_milestone(a,71,b);h="L";CPWbot_bg.mark_timestamp("logout_cpw");var d=CPWbot_bg.navigate_to_logout(a,c);null===d?verbose_log("L: navigate_to_logout / CS callout "):d?A(a,b,c):(CPWbot_bg.do_milestone(a,137,b,""),B(a));return!0}
function z(a,b,c){L("post_L");I=!1;var d=$b(b);d||(d=1E3);if(d&&!Pa)return h="Lsleep",L("L sleeping "+d),I=!0,ka=ba+d,Pa=!0,null;Pa=!0;cb&&D(a,b,Ib);return g_cpw_do_fakeui?(b&&c&&null!==a&&g_cpw_do_fakeui&&(h="FK0",verbose_log("entered do_logged_out_fake_ui")),d=Ya(b),setTimeout(function(){A(a,b,c)},0*d+1017),null):A(a,b,c)}function xa(a,b,c){CPWbot_bg.mark_timestamp("login_entry");verbose_log("M4: FILL LOGIN");h="M4";if(!Pb(a,b,R))return CPWbot_bg.do_milestone(a,130,b,""),B(a),!1;verbose_log("M5: SUBMIT LOGIN ENTRY");
h="M5";var d=1100,e=tb(b);e&&(d=e);d&&verbose_log("waiting "+d+" ms after login waiting for site to bootstrap");e=Qb(a,b,R);!1===e?(CPWbot_bg.do_milestone(a,141,b,""),B(a),a=!1):null===e?(d&&(I=!0,ka=ba+d),a=null):a=ra(a,b,c);return a}function ra(a,b,c){verbose_log("M2: validate_login_entry_success ");h="M2";var d;d=CPWbot_bg.validate_login_entry_success(a,b,R);if(null===d)return verbose_log("M2: validate_login_entry_success / CS callout "),v=!0,L("VALIDATE_IN_DOCWAIT=true"),null;verbose_log("M2: validate_login_entry_success "+
d+" no CS callout ");if(d)c.check_login_entry_form=!1,C(a,b,c);else return CPWbot_bg.do_milestone(a,141,b,X),B(a),retval}var t=d.aid,l=d.recipe,ba=(new Date).getTime();c=!1;0==ib&&(CPWbot_bg.mark_timestamp("initial_cycle"),ed(l),CPWbot_bg.do_milestone(a,72,l),null!==CPWbot_bg.broken_hearted_st_id&&clearTimeout(CPWbot_bg.broken_hearted_st_id),CPWbot_bg.broken_hearted_st_id=null,hc(a,l));ib++;e("engine awaken tick="+ib);if(null===h)B(a);else if(Da||!lploggedin)nc(a,l);else{if(!wa){var G=ub(l);G||(G=
DEFAULT_SESSION_TIMEOUT);var Y=CPWbot_bg.get_timestamp("docaptcha_success");Y||(Y=CPWbot_bg.get_timestamp("initial_cycle"));Y||(Y=rc);if(ba>Y+G*V){c=!0;CPWbot_bg.do_milestone(a,140,l,"engine");CPWbot_bg.panic("TIMEOUT-engine");return}}G=Wa(l);r&&0<qb&&ba>qb+G&&(dd(l)?pass:(v=!1,L("ENGINE - VALIDATE_IN_DOCWAIT=false"),CPWbot_bg.finish_cpwbot_validate_state(a,S,Tb,Ub,T)));if(b&&I)if(ba>ka)e("AWAKEN FROM SLEEP");else{e("CONTINUE SLEEPING");Aa(a,h,d);return}var la=null;for(b=0;b<oa.length;b++)switch(G=
oa[b],Y=G.data.docnum,e(sprintf("[%s][%d] processing event#%d cmd=%s",a,Y,b,G.data.cmd)),G.type){case "validate_response":CPWbot_bg.cpwbot_validate_state_result_handler(G.tabid,G.data);break;case "fill_ack":CPWbot_bg&&CPWbot_bg.fill_ack_handler(G.tabid,G.data);break;case "click_ack":CPWbot_bg&&CPWbot_bg.click_ack_handler(G.tabid,G.data);break;case "js_ack":CPWbot_bg&&CPWbot_bg.js_ack_handler(G.tabid,G.data);break;case "finish_ack":CPWbot_bg&&CPWbot_bg.cpwbot_finish_ack_handler(G.tabid,G.data);break;
case "loadurl":if(g_CS_tops&&g_CS_tops[a]==Y)switch(O&&(O=!1,e("m_in_loadurl cleared")),e("loadurl/setprefs against top :"+g_CS_tops[a]+" == "+Y+" start_state="+CPWbot_bg.get_pwchangestate()),h){case "A1":case "A2":case "A3":case "M":case "B1":case "F":CPWbot_bg&&Z&&(CPWbot_bg.force_validate_retry(!0),CPWbot_bg.retry_validate(a));break;case 0:case "0":e("engine called in initial state - ignoring")}else null!==CPWbot_bg.get_pwchangetabid()&&CPWbot_bg.in_validate()?(L("processing loadurl event, reissue last validate to new doc ["+
a+"]["+Y+"]"),CPWbot_bg.retry_validate(a,Y)):null!==CPWbot_bg.get_pwchangetabid()&&(ha||ea||ga||sa||na||ta||va||ma)&&(L("loadurl sent while waiting for a click, issue last click to new frame"+Y),kc(a,Y));break;case "unload":break;default:e("need to handle this msg: "+G.data.cmd)}CPWbot_bg.clear_event_queue();e("current state is "+h);var R=ja;h&&null===R&&(R={aid:t});switch(h){case 0:ua(a,l,R);break;case "A1":CPWbot_bg.in_validate()||v?(e("waiting for validate to end, "+h),pass):Ca?(e("waiting for doc-complete for Cnav, "+
h),pass):r?e("A1: wait on m_in_validate"):(t=la=Q)?(CPWbot_bg.do_milestone(a,67,l),pa(a,l,d)):null===t?CPWbot_bg.alert("A1 unexpected"):A(a,l,d);break;case "A3R":va?(e("waiting for click_ack, "+h),ia(a),pass):O?(e("waiting for loadurl , "+h),pass):E(a,l,d);break;case "B1Rpre":aa(a,l,d);break;case "B1R":ma?(e("waiting for click_ack, "+h),ia(a),pass):O?(e("waiting for loadurl , "+h),pass):r?e("B1R: wait on m_in_validate"):jc(a,l,d);break;case "B1":if(CPWbot_bg.in_validate()||v)e("waiting for validate to end, "+
h),pass;else if(r)e("B1: wait on m_in_validate");else{t=la=Q;if(y&&y.found_interactive){console_error("B1: found interactive field");Ba(a,l);return}if(t)F(a,l,d);else{debug&&g_innerHTML_debug&&y.innerhtml&&verbose_log("VALIDATE FAILURE, final innerHTML is "+y.innerhtml);var X="";CPWbot_bg.do_milestone(a,130,l,X);B(a);return}}break;case "A2":if(CPWbot_bg.in_validate()||v)e("waiting for validate to end, "+h),pass;else if(r)e("A2: wait on m_in_validate");else if(Ca)e("A2: wait on navigate");else{if(y&&
y.found_interactive){console_error("A2: found interactive field");Ba(a,l);return}if(la=Q)f(a,l,d);else{X="";CPWbot_bg.do_milestone(a,129,l,X);B(a);return}}break;case "A3":if(CPWbot_bg.in_validate()||v||r)e("waiting for validate to end, "+h),pass;else{t=la=Q;if(y&&y.found_interactive){console_error("A3: found interactive field");Ba(a,l);return}t?(e("A3: has login form, calling do_A4"),y&&y.found_interactive&&e("A3: found_interactive=true"),F(a,l,d)):(debug&&g_innerHTML_debug&&y.innerhtml&&verbose_log("VALIDATE FAILURE, final innerHTML is "+
y.innerhtml),P(a,l,d))}break;case "M":if(CPWbot_bg.in_validate()||v||r)e("waiting for validate to end, "+h),pass;else{t=la=Q;if(y&&y.found_interactive){console_error("M: found interactive field");Ba(a,l);return}t?xa(a,l,d):(verbose_log("did not find initial stage login form"),y.innerhtml&&verbose_log("final innerHTML is "+y.innerhtml),d.check_login_entry_form=!1,C(a,l,d))}break;case "M2":if(CPWbot_bg.in_validate()||v)e("waiting for validate to end, "+h),pass;else if(r)e("M2: wait on m_in_validate");
else if(Ca)e("M2: wait on navigate");else{if(y&&y.found_interactive){console_error("M2: found interactive field");Ba(a,l);return}if(la=Q)d.check_login_entry_form=!1,C(a,l,d);else{X="";y&&(X=sprintf("found_bad_match=%s, num_ok_matches=%s, retval=%s, url_success_match=%s, url_failure_match=%s",y.found_bad_match,y.num_ok_matches,y.retval,y.url_success_match,y.url_failure_match));CPWbot_bg.do_milestone(a,141,l,X);B(a);return}}break;case "A4":break;case "A5":K(a,l,d);break;case "M5":ra(a,l,d);break;case "A":console_warn("engine state=A todo");
break;case "B":O?(e("waiting for loadurl to complete, "+h),pass):jb?(e("waiting for doc-complete after loadurl, "+h),pass):U(a,l,d);break;case "Bsleep":jb?(e("waiting for doc-complete after loadurl, "+h),pass):U(a,l,d);break;case "C":ga?(e("waiting for click_ack, "+h),ia(a),pass):O?(e("waiting for loadurl , "+h),pass):ya?(e("waiting for reveal-cpw doc-complete, "+h),pass):(t=g_CS_tops[a],"undefined"==typeof t&&(t=null),b=null,null!==t?(b=getcsinfo(a,t))?(G=b.docstate,"complete"==b.docstate&&"complete"==
G?(e("C: wait completed "+h),g(a,l,d)):e("C: wait docstate:"+b.docstate+",last:"+G)):e("C: fail"):e("C: wtf - wait for page to finish loading?"),null!==t?ping(a,t):ping(a));break;case "Cnav":L("aid = "+W.payload.aid);CPWbot_bg.navigate_to_acctmgmt(a,W);W=null;break;case "Cpickup":ga&&(L("still waiting for click-C"),e("waiting for click_ack, "+h),ia(a));ya?L("still waiting for document-complete to run reveal_cpw"):g(a,l,d);break;case "A3Rsleep":E(a,l,d);break;case "B1Rsleep":C(a,l,d);break;case "Csleep":ya?
L("still waiting for document-complete to run reveal_cpw"):g(a,l,d);break;case "Dpickup":iscpwfast()&&CPWbatch.conditional_website_status_update({aid:t,state:76,msg:"SLOW"});ea?(L("still waiting for click-D"),e("waiting for click_ack, "+h),ia(a)):m(a,l,d);break;case "Dsleep":m(a,l,d);break;case "Epickup":iscpwfast()&&CPWbatch.conditional_website_status_update({aid:t,state:76,msg:"SLOW"});ha?(L("still waiting for click-E"),e("waiting for click_ack, "+h),ia(a)):(d.validate_result=null,u(a,l,d));break;
case "Esleep":d.validate_result=null;u(a,l,d);break;case "D":e("engine handle D");ea||O?(ea?(e("waiting for click_ack, "+h),ia(a)):e("waiting for load to complete, "+h),pass):(t=g_CS_tops[a],"undefined"==typeof t&&(t=null),b=null,null!==t?(b=getcsinfo(a,t))?(G=b.docstate,"complete"==b.docstate&&"complete"==G?(e("D: wait completed "+h),m(a,l,d)):e("D: wait docstate:"+b.docstate+",last:"+G)):e("D: fail"):e("D: wtf - wait for page to finish loading?"),null!==t?ping(a,t):ping(a));break;case "Dreveal":CPWbot_bg.reveal_cpw(a,
W);W=null;break;case "D1":if(CPWbot_bg.in_validate()||v)e("waiting for validate to end, "+h),pass;else if(r)e("D1: wait on m_in_validate");else if(Ia)e("D1: wait on doc-complete for trigger_cpw");else{t=la=Q;if(y&&y.found_interactive){console_error("D1: found interactive field");Ba(a,l);return}t?n(a,l,d):q(a,l,d)}break;case "D2":if(CPWbot_bg.in_validate()||v)e("waiting for validate to end, "+h),pass;else if(r)e("D2: wait on m_in_validate");else if(la=Q)p(a,l,d);else{X="";CPWbot_bg.do_milestone(a,
134,l,X);B(a);return}break;case "D4":break;case "D5":sa?(e("waiting for click_ack, "+h),ia(a)):Ia?e("D5: wait on doc-complete for trigger_cpw"):n(a,l,d);break;case "D3":console_error("D3 reached - should not happen");break;case "D_validate_cpw_form":da(a,W);W=null;break;case "E":console_error("E: should not occur");break;case "Etrigger":ha?(e("waiting for click_ack, "+h),ia(a)):O?console_error("Etrigger: m_in_loadurl should not happen"):r?console_error("Etrigger: m_in_validate should not happen"):
(CPWbot_bg.trigger_cpw(a,W),W=null);break;case "F":if(CPWbot_bg.in_validate()||v)e("waiting for validate to end, "+h),pass;else if(O)e("waiting for loadurl and doc-complete"),pass;else if(r)e("F: wait on m_in_validate"),pass;else{CPWbot_bg.bagration();var ca=la=Q;null!==ca&&(verbose_log("F: VALIDATE return from CS, returned "+ca),debug&&g_innerHTML_debug&&Q.innerhtml&&!ca&&verbose_log("VALIDATE FAILURE, final innerHTML is "+Q.innerhtml),X="",ca?(verbose_log("cpwbot initiate: validate cpw succeeded, now updating user record"),
Hc(a,l,R)?(CPWbot_bg.do_milestone(a,63,l),c=za(t),c=lpdec_acct(wb,c,"undefined"==typeof g_shares?lpshares:g_shares),t=lp_gettld_url(l?l.login_url:null),verbose_log('remember to g_didchangepw for pw="'+(g_show_pw_in_logs||g_isadmin?c:"REDACTED")+'" tld='+t),remember_changed_pw(c,t)||verbose_log('save to g_didchangepw failed for pw="'+(g_show_pw_in_logs||g_isadmin?c:"REDACTED")+'" tld='+t),x(a,l,d)):CPWbot_bg.do_milestone(a,136,l,X)):CPWbot_bg.do_milestone(a,135,l,X));B(a);c=!0}break;case "G":break;
case "L":na?(e("waiting for click_ack, "+h),ia(a),pass):O?(e("waiting for loadurl , "+h),pass):(t=g_CS_tops[a],"undefined"==typeof t&&(t=null),b=null,null!==t&&((b=getcsinfo(a,t))?"complete"==b.docstate&&(e("L: wait completed "+h),z(a,l,d)):e("L: fail")),null!==t?ping(a,t):ping(a));break;case "Lsleep":z(a,l,d);break;case "Bagration":break;case "FK0":break;case "FK1":break;case "FK2":break;case "FKI":break;case "FK3":A(a,l,d);break;case "FKLL0":break;case "FKLL1":break;case "FKLL2":break;case "FKLLI":break;
case "FKLL3":f(a,l,d);break;default:pass}c||Aa(a,h,d)}};this.initialize_engine=function(a,b){rc=(new Date).getTime();var d=b.recipe;ja=b;CPWbot_bg.mark_timestamp("initialize_engine");Ja=r=I=Pa=Oa=Na=Ma=La=Ka=m_in_logout_reveal=jb=ya=Ca=Ia=O=!1;CPWbot_bg.do_milestone(a,65,d);var c=ad(d);if(c)xb||(xb=!0,setTimeout(function(){Aa(a,0,b);return!1},c));else if(Hb(d)&&!yb){var c=5E3,e=bd(d);e&&(c=e);yb=!0;verbose_log("initial JS inject before beginning - inject, and wait ");CPWbot_bg.conditional_js_exec(a,
d,Hb);setTimeout(function(){Aa(a,0,b);return!1},c)}else Aa(a,0,b)};this.push_event_queue=function(a,b,d){if("validate_response"==a&&"undefined"!=typeof d.desc&&"docaptcha"==d.desc)wa&&0<JSON.parse(d.result_obj).num_ok_matches&&(CPWbot_bg.mark_timestamp("docaptcha_success"),D(b,C,Cc),wa=!1,CPWbot_bg.show_cpwbot_overlay(b,null,null),hc(b,C),Z=null,r=!1,y.found_interactive=!1,Q=!0,Aa(b,h,ja));else{var c={};c.type=a;c.data=d;c.tabid=b;c.docnum=d.docnum;c.addtime=new Date;null===oa&&(oa=[]);"undefined"!=
typeof c.docnum&&verbose_log(sprintf("[%s][%d] pushed event : %s cmd=%s",b,c.docnum,a,d.cmd));oa.push(c)}};this.clear_event_queue=function(){oa=[]};this.select_execute=function(a,b,d,c){};this.select=function(){};this.bagration=function(){h="Bagration"};this.in_bagration=function(){return"Bagration"==h};this.get_selenium_tabid=function(){return qc};this.navigate_to_logout=function(a,b){if(!b)return!1;h="L";cb=!1;var d=b.recipe;if(!d)return!1;var c=!1,e;e=D(a,d,xc);m(E,"Navigate to Logout");var f=
K(d);if(f)return L("call logout:loadurl with "+f),e=null,g_CS_tops&&(e=g_CS_tops[a]),sendCS(a,{cmd:"loadurl",url:f},e),O=!0,verbose_log("m_in_loadurl set"),C=d,ja=b,cb=!0,null;na=!1;if(f=M(d,FN_NAVIGATE_TO_LOGOUT)){verbose_log("click on FN_NAVIGATE_TO_LOGOUT field!");c=DEFAULT_CLICK_DELAY;"undefined"!=typeof d.logout_delay&&(c=d.logout_delay);na=!0;verbose_log("now waiting for click_ack L");var g=J(d);qa(a,f,c,g);CPWbot_bg.mark_timestamp("wait_for_click_ack_L");c=null}f=!1;d?"undefined"!=typeof d.logout_js_delay&&
(f=d.logout_js_delay?!0:!1,"0"===d.logout_js_delay&&(f=!1)):f=null;if(f&&(cb=!0,$b(d)))return null;e=e||D(a,d,Ib);!1===c&&e&&(c=!0);return c};var V=1,p=null;this.get_timestamp=function(a){if(!a)return null;null===p&&(p=new mc);return p[a]};this.get_timestamps=function(){return p};this.mark_timestamp=function(a){if(null===p||"dopwchange"==a)p=new mc;var b=(new Date).getTime();p[a]=b;return!0};this.dump_timestamps=function(){var a;if(p)for(a in p)L(sprintf("[%s] timestamp %s : %d",U(C),a,p[a]));lc(C,
V);return!0};this.get_last_timestamp=function(a){var b,d="dopwchange";if(p){for(b in p)(!a||"fail"!==b&&"finish_complete"!=b&&"success"!=b)&&p[b]>p[d]&&(d=b);return d}return null};this.broken_hearted=function(a){CPWbot_bg&&(a!=CPWbot_bg.get_session()?m(P,"stale setTimeout - clearTimeout did not work"):(a=CPWbot_bg.get_timestamp("initial_cycle"),(new Date).getTime(),"undefined"==typeof a&&(a=null),a||"preinit"!=h&&h||CPWbot_bg.get_okstate()||CPWbot_bg.get_failstate()||CPWbot_bg.in_bagration()||(CPWbot_bg.do_milestone(x,
133,C,"brokenhearted"),CPWbot_bg.panic("TIMEOUT-brokenhearted"))))};this.new_session=function(a){a||(a="");var b=(new Date).getTime();null===b&&(b=0);return zb=("function"==typeof lp_sha256?lp_sha256:SHA256)(a.toString()+b.toString())};this.get_session=function(){return zb};this.clear_session=function(){zb=""};this.halt=function(a){if(a&&"undefined"!==typeof a.aid&&CPWbot_bg.getpwchangeaid()!==a.aid)return!1;null!==CPWbot_bg.docaptcha_si_id&&clearInterval(CPWbot_bg.docaptcha_si_id);CPWbot_bg.docaptcha_si_id=
null;Da=!0;L("Halt Requested")};this.cpw_dialog_minimize_state=0;this.getpwchangeaid=function(){return ca};this.phone_home=function(a,b,d){if(!d)return!1;b||(b=C);var c=(new Date).getTime();a=(c-CPWbot_bg.get_timestamp("dopwchange"))/1E3;if(0>a||isNaN(a))a=0;c=(c-CPWbot_bg.get_timestamp("initial_cycle"))/1E3;if(0>c||isNaN(c))c=0;var e=CPWbot_bg.get_last_timestamp(!0),f=d.msg?d.msg:"";b=sprintf("[%s][%s][R=%s][L=%s][M=%s][%6.2fsec elapsed][%2.1f TF][%6.2fsec TiE]","cpw",d.severity?d.severity:"",b?
U(b):"bad-recipe",e,f,a,V,c);L(b);lpReportError(b,null);return!0};this.warning_phone_home=function(a){return ra(a)};this.site_html_url="";"undefined"!=typeof g_iscasper&&g_iscasper&&(this.get_validate_timeout=function(a){return Wa.apply(this,arguments)},this.get_symbolic=function(a){return U.apply(this,arguments)},this.get_logout_url=function(a){return K.apply(this,arguments)},this.get_generate_prefs_from_recipe=function(a){return Xb.apply(this,arguments)},this.set_last_overlay_message=function(a){return f.apply(this,
arguments)},this.clear_last_overlay_message=function(a){return g.apply(this,arguments)},this.validate_xpath=function(a){return bc.apply(this,arguments)},this.validate_recipe=function(a){return cc(a)},this.get_cpw_login_password_field=function(a){return q.apply(this,arguments)},this.get_cpw_login_username_field=function(a){return Qa.apply(this,arguments)},this.get_login_submit_field=function(a){return Ra.apply(this,arguments)},this.get_login_reveal_field=function(a){return kb.apply(this,arguments)},
this.replace_constants=function(a){return replace_constants.apply(this,arguments)},this.set_pwchangestate=function(a){h=a;return!0},this.in_wait_for_click=function(){return ha||ea||ga||sa||na||ta||va||ma},this.submit_login_form=function(a,b,d){return pb(a,b,d)},this.fill_login_form=function(a,b,d){return Ta(a,b,d)},this.clear_wait_for_clicks=function(){return ec()},this.get_event_queue=function(){return oa},this.reset_private_test_vars=function(){v=r=hb=!1},this.should_click_on_fill=function(a){return Ua(a)},
this.should_fill_password_fields_via_keys=function(a){return Va(a)},this.get_fill_delay=function(a){return Ya(a)},this.random_delay=function(a){a||(a=100);return"undefined"==typeof Math?0:Math.floor(Math.random(a)+10)},this.random_sleep=function(a,b){return gd(a,b)},this.get_cpw_session_timeout=function(a){return ub(a)},this.fill_login_entry_form=function(a,b,d){return Pb(a,b,d)},this.submit_login_entry_form=function(a,b,d){return Qb(a,b,d)},this.set_pwchange_validate_desc=function(a){T=a;return!0},
this.check_recipe_symbols=function(a){return dc(a)},this.set_in_validate_outer=function(){return v=r=!0},this.set_in_validate_inner=function(a,b){Z={cmd:"cpwbot_validate_state",desc:b,id:a};S=a;oc.set_pwchange_validate_desc(b);null===F&&(F=[])},this.get_in_sleep=function(){return I},this.clear_sleeps=function(){I=Pa=Oa=Na=Ma=La=Ka=!1});return!0}
function get_recipe_for_url(f,g){lp_gettld_url(f);var K,J;g_isfirefox?(K=LP.lpMakeRequest,J=LP.lp_base):(K=lpMakeRequest,J=base_url);K(J+"get_recipe.php","url="+encodeURIComponent(f),function(f){if(4==f.readyState){if(200==f.status&&null!=f.responseXML&&null!=f.responseXML.documentElement&&(f=f.responseXML.documentElement.getElementsByTagName("result"),0<f.length))if(f=f[0].getAttribute("recipe"),""==f)CPWbatch&&CPWbatch.cpw_get_batchjob_state()||CPWbot_bg.alert("This url is not supported yet"),CPWbot_bg.do_milestone(null,
128,null,"no recipe");else{g(replace_constants(JSON.parse(f)));return}g(null)}},function(){g(null)})}function ping_ack_handler(f,g){var K=g.docnum,J=g.url,q=g.id,Qa=g.delta,Ra=(new Date).getTime()-g.timestamp;debug&&L("received ping response from [tabid:"+f+"][docnum:"+K+"][id:"+q+" sent: "+Qa+"ms, response: "+Ra+"ms docstate="+g.docstate+" url="+J);q=getcsinfo(f,K);q||(q=new CS_t,q.docnum=K,q.tabid=f);q.url=J;q.docstate=g.docstate;q.flags=g.flags;setcsinfo(f,K,q)}
function ping(f,g){var K=(new Date).getTime(),J=!1;if("undefined"==typeof f||null===f)J=!0;if("undefined"==typeof g||null===g)g="all";var q=("function"==typeof lp_sha256?lp_sha256:SHA256)(g_username+""+f+""+g+""+K);debug&&L("sending ping id="+q);if(J)for(f in g_CS)"undefined"!=typeof f&&null!==f&&sendCS(f,{cmd:"ping_req",id:q,timestamp:K},g);else sendCS(f,{cmd:"ping_req",id:q,timestamp:K},g)}
function cpwbot_getpwchangestate(){return g_cpwbot&&CPWbot_bg?"Bagration"==CPWbot_bg.get_pwchangestate()?!0===CPWbot_bg.get_failstate()?!0===CPWbot_bg.get_failpwsavedstate()?"FAIL_PW_SAVED":"FAIL":!0===CPWbot_bg.get_okstate()?"OK":null:!0===CPWbot_bg.get_captchastate()?"CAPTCHA":!0===CPWbot_bg.get_docaptchastate()?"DOCAPTCHA":!0===CPWbot_bg.get_brokenheartstate()?"TIMEOUT":"preinit"==CPWbot_bg.get_pwchangestate()?null:!0===CPWbot_bg.get_failstate()?!0===CPWbot_bg.get_failpwsavedstate()?"FAIL_PW_SAVED":
"FAIL":!0===CPWbot_bg.get_okstate()?"OK":CPWbot_bg.get_pwchangestate():"FAIL"}function cpwbot_preinit(){CPWbot_bg&&CPWbot_bg.preinit()}function cpwbot_get_user_debug_messages(){if(CPWbot_bg)return CPWbot_bg.get_user_debug_messages()}function cpwbot_get_dialog_msg(){if(CPWbot_bg)return CPWbot_bg.get_dialog_msg()}function cpwbot_halt(){if(CPWbot_bg)return CPWbot_bg.halt()}function cpwbot_minimize_dialog(){CPWbot_bg&&(CPWbot_bg.cpw_dialog_minimize_state=1)}
function cpwbot_maximize_dialog(){CPWbot_bg&&(CPWbot_bg.cpw_dialog_minimize_state=0)}function cpwbot_get_minimize_dialog_state(){if(CPWbot_bg)return CPWbot_bg.cpw_dialog_minimize_state};
