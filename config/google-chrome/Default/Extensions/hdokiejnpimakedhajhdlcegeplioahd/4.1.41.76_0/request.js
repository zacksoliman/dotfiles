LPRequest={};
(function(f){var h={},l=function(){for(var d in h)clearTimeout(h[d]);h={}};Topics.get(Topics.REFRESH_DATA).subscribe(l);Topics.get(Topics.CLEAR_DATA).subscribe(l);f.getNewRequestID=function(){var d=0;return function(){return++d}}();f.makeRequest=function(){var d=function(c,a){return function(){for(var b=0,e=c.length;b<e;++b)c[b].unlock();a&&a.apply(window,arguments)}},k=function(c,a){return function(){for(var b=0,e=c.length;b<e;++b)c[b].lockForUpdate();a.apply(window,arguments)}},l=function(c,a){var b=
function(e){try{Topics.get(Topics.REQUEST_SUCCESS).publish(c),a&&(clearTimeout(a),delete h[c.requestID]),e&&Topics.get(Topics.SUCCESS).publish(e)}catch(g){LPPlatform.logException(g)}};return c&&c.success?function(){var a=arguments,d=c.successMessage;0<a.length&&"string"===typeof a[0]&&(d="undefined"===typeof d?a[0]:d,a=Array.prototype.slice.call(a,1));try{c.success.apply(window,a)}catch(m){LPPlatform.logException(m)}b(d)}:b},n=function(c,a){var b=function(b){try{switch(b){case "notoken":b=Strings.translateString("No token was provided. Request could not be completed.");
break;case "session_expired":b=Strings.translateString("ErrorSessionMsg");break;case "not_allowed":b=Strings.translateString("Your Shared Folder action failed. Please check your permissions before trying again");break;case "invalidxml":b=Strings.translateString("Invalid XML response.");break;case "invalidjson":b=Strings.translateString("Invalid JSON response.");break;case "offline":b=Strings.translateString("This request cannot be completed because you are currently offline.");break;case void 0:b=
Strings.Vault.UNEXPECTED_ERROR}Topics.get(Topics.ERROR).publish(b);Topics.get(Topics.REQUEST_ERROR).publish(c);a&&(clearTimeout(a),delete h[c.requestID])}catch(g){LPPlatform.logException(g)}};return c&&c.error?function(a){b(a);c.error()}:b},p=function(c){return function(a){Topics.get(Topics.REQUEST_STATUS).publish(a,c)}};return function(c,a){if(a.confirm){var b=a.confirm;delete a.confirm;b.handler=function(){f.makeRequest(c,a)};Topics.get(Topics.CONFIRM).publish(b)}else{a.requestID=f.getNewRequestID();
b=null;LPTools.getOption(a,"showTimeWarning",!0)&&(b=setTimeout(function(){g(Strings.translateString("Sorry, this request is taking longer than normal."))},3E4),h[a.requestID]=b);if(a.items&&LPTools.getOption(a,"lockItems",!1)){var e=a.items;e instanceof Array||(e=[e]);c=k(e,c);a.success=d(e,a.success);a.error=d(e,a.error);a.confirm&&(a.confirm.closeHandler=d(e))}var e=l(a,b),g=n(a,b);a.params?b=[{params:a.params,requestArgs:a.requestArgs,success:e,error:g,status:a.status?p(a):null}]:(b=LPTools.getOption(a,
"parameters",[]),b instanceof Array||(b=[b]),b.push(e),b.push(g));Topics.get(Topics.REQUEST_START).publish(a);try{c.apply(window,b)}catch(m){LPPlatform.logException(m),g(Strings.Vault.UNEXPECTED_ERROR)}}}}();f.makeDataRequest=function(d,k){f.makeRequest(d,$.extend(!0,k,{dialogRequest:!1}))};f.makeUpdateRequest=function(d,k){f.makeRequest(d,$.extend(!0,k,{requestSuccessOptions:{incrementAccountsVersion:!0}}))};f.makeLockItemUpdateRequest=function(d,f){this.makeUpdateRequest(d,$.extend(f,{lockItems:!0}))}})(LPRequest);
