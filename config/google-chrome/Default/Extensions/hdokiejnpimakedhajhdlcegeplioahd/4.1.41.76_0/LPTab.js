LPTab=function(){var f=function(e,b,d){this.loadedContexts={};this.data=d;this.instance=b;this.tab=e};f.prototype.extendInstance=function(e){e&&e.context&&!this.loadedContexts.hasOwnProperty(e.context)&&(Interfaces.createInstance(Interfaces[this.tab.tabDetails.interfaceName],{instance:this.instance,direct:!1,context:e.context,requestFunction:this.data.contentScriptRequester}),this.loadedContexts[e.context]=!0)};f.prototype.getFrameID=function(){return this.data.frameID};f.prototype.isTop=function(){return this.data.topWindow};
f.prototype.getInstance=function(){return this.instance};return function(e){var b=null,d={},h=new LPEventManager,k=0,l=null;this.tabDetails=e;this.getTop=function(){return b?b.instance:null};this.extendTop=function(a){b.extendInstance(a)};var m=function(){clearTimeout(l);Object.keys(d).length>=k?h.publishEvent("framesloaded"):l=setTimeout(function(){h.publishEvent("framesloaded")},1E3)};this.addFrame=function(a,c){var g=new f(this,a,c);g.isTop()?b=g:d[g.getFrameID()]=g;k+=c.childFrameCount;m()};this.removeFrame=
function(a){d[a]?(delete d[a],--k):b&&b.getFrameID()===a&&(b=null)};this.getFrames=function(){var a={},c;for(c in d)a[c]=this.getFrame(c);return a};this.extendFrames=function(a){for(var c in d)d[c].extendInstance(a)};this.getFrame=function(a){var c=null;d[a]?c=d[a]:b&&b.getFrameID()===a&&(c=b);return c?c.getInstance():null};this.isEmpty=function(){return null===b&&0===Object.keys(d).length};var n=function(a,c){var b=Object.keys(a).length,d=0,e=function(){++d;d===b&&c.done()},f;for(f in a)c.each(a[f],
e)||--b;0===b&&c.done&&c.done()};this.forEachFrame=function(a){n(this.getFrames(),a)};this.forEachWindow=function(a){var c=this.getFrames(),b=this.getTop();b&&(c[0]=b);n(c,a)};this.activate=function(){this.isEmpty()||LPPlatform.activateTab({tabID:this.tabDetails.tabID,windowID:this.tabDetails.windowID,frameID:b.getFrameID()})};this.close=function(){this.isEmpty()||LPPlatform.closeTab({tabID:this.tabDetails.tabID,windowID:this.tabDetails.windowID,frameID:b.getFrameID()})};this.onFramesLoaded=function(a){h.addEventListenerOnce("framesloaded",
a);setTimeout(m,1E3)}}}();
