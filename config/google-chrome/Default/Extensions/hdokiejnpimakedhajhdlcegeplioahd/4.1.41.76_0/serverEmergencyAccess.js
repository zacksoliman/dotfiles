LPServer.emergencyAccess=function(){var e=function(a){var c=new LPServer.ext.RSAKey;LPServer.ext.parsePublicKey(c,a.params.recipient.publickey);c=c.encrypt(LPServer.ext.bin2hex(LPServer.ext.getLocalKey()));LPServer.jsonRequest({url:"legacy_helper.php",data:{action:"update_sharee",semail:a.params.recipient.username,enc_key:c,prio:1,hours:a.params.recipient.hours_to_override},userSupplied:a})},f=function(){var a=function(a,b){a.errors instanceof Array&&0<a.errors.length?b.callbacks&&b.callbacks.nosharingkeys?
b.callbacks.nosharingkeys(a,b):b.error("nosharingkeys"):a.noemail instanceof Array&&0<a.noemail.length?(b.callbacks&&b.callbacks.invite&&b.callbacks.invite({emails:a.noemail}),b.error("")):a[b.params.recipient.username]?(b.params.recipient.publickey=a[b.params.recipient.username],e(b)):b.error()};return function(c){LPServer.jsonRequest({url:"legacy_helper.php",data:{action:"get_pubkey",emails:c.params.recipient.username},success:a,userSupplied:c})}}(),g=function(){var a=function(a,b){b.callbacks&&
b.callbacks.successGranted&&b.callbacks.successGranted(a,b)},c=function(a,b){b.callbacks&&b.callbacks.successLinked&&b.callbacks.successLinked(a,b)},b=function(a,b){var d=new LPServer.ext.RSAKey;LPServer.ext.parsePrivateKey(d);d=d.decrypt(a.enc_key);LPServer.xmlRequest({url:"legacy_helper.php",data:{action:"link",name:b.params.sharer.username,legacy:1,sharekey:a.enc_key,sharename:LPServer.ext.encrypt(b.params.sharer.username,LPServer.ext.hex2bin(d))},callbacks:{ok:c},userSupplied:b})};return function(c){LPServer.jsonRequest({url:"legacy_helper.php",
data:{action:"confirm",lemail:c.params.sharer.username},callbacks:{success:a,allowed:b},userSupplied:c})}}();return{updateRecipient:e,addRecipient:f,removeRecipient:function(a){LPServer.jsonRequest({url:"legacy_helper.php",data:{action:"revoke_offer",email:a.params.email},userSupplied:a})},getRecipientInfo:function(a){LPServer.jsonRequest({url:"legacy_helper.php",data:{action:"get_sharees",lemail:a.params.email},userSupplied:a})},getSharerInfo:function(a){LPServer.jsonRequest({url:"legacy_helper.php",
data:{action:"get_sharers"},userSupplied:a})},acceptOffer:function(a){LPServer.jsonRequest({url:"legacy_helper.php",data:{action:"accept_offer",email:a.params.sharer.username},userSupplied:a})},declineOffer:function(a){LPServer.jsonRequest({url:"legacy_helper.php",data:{action:"decline_offer",email:a.params.email},userSupplied:a})},requestAccess:g,denyAccess:function(a){LPServer.jsonRequest({url:"legacy_helper.php",data:{action:"deny_access",email:a.params.email},userSupplied:a})},unlinkAccount:function(a){LPServer.jsonRequest({url:"legacy_helper.php",
data:{action:"unlink",lemail:a.params.email},userSupplied:a})}}}();
