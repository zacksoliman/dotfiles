LPBackgroundRequester=function(h){return function(m,b){b=b||{};var n=this,c=null,e=!1,f=[],d,p=b.interfaceDefinition,k=Date.now(),q=function(a,c){LPMessaging.handleRequest(p,a,function(a){g({type:"contentScriptResponse",data:a,frameID:c})},{context:b.reflectionContext,additionalArguments:c})},g=function(a){a.sourceFrameID=c;LPMessaging.makeRequest(d,a)},r=function(a){var c=b.reflectionContext||h,d=function(){var b="interactive"===document.readyState||"complete"===document.readyState;b&&(a(),c.removeEventListener("readystatechange",
d,!0));return b};d()||c.addEventListener("readystatechange",d,!0)},t=function(a){if(a.frameID===c)switch(a.type){case "backgroundResponse":case "contentScriptResponse":LPMessaging.handleResponse(a.data);break;case "contentScriptRequest":q(a.data,a.sourceFrameID)}else if("initialization"===a.type&&(a=a.data,null===c&&a.request.initializationID===k)){"undefined"!==typeof Topics&&Topics.get(Topics.REQUEST_FRAMEWORK_INITIALIZED).publish(a,n);c=a.frameID;e=!1;d({type:"initialized",sourceFrameID:c});a=
0;for(var b=f.length;a<b;++a)f[a]()}},l=function(a){r(function(){d({type:"initialize",data:{initializationID:k,interfaceName:b.interfaceName,top:b.mainRequestFramework,url:h.location.href,childFrameCount:document.getElementsByTagName("iframe").length,frameIdentity:a}})})};this.initialize=function(a){null!==c||e||(d=m(t),b.frameIdentityManager?b.frameIdentityManager.getFrameIdentity(l):l(),e=!0);a&&f.push(a)};this.sendRequest=function(a){null===c?this.initialize(function(){g(a)}):g(a)}}}(this);
