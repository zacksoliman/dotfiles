LPSiteNotification=function(){var h=!1,r=!1,n=!1,x=function(){return function(a){var b;a:{for(b=0;b<a.fields.length;++b)if("password"===a.fields[b].type){b=!0;break a}b=!1}b?(a.generatedPassword||(h=!0),bg.LPTabState.processPasswordSubmit({formData:a,callback:a.generatedPassword||LPContentScriptTools.isUnloading()?null:w})):(0<a.fields.length&&bg.LPTabState.processTextSubmit(a),bg.LPTabState.clear())}}(),u=function(){var a=function(c){return $(c||document.body).find('input:not([type]),input[type="text"],input[type="email"],input[type="password"]').filter(function(){return this.value&&
(this.value!==this.getAttribute("value")||1<this.value.length)&&LPContentScriptTools.isVisible(this)})},b=function(){var c=["submit","click","keydown"],a={},d=!1;return function(e,b){-1<c.indexOf(e)?(a[e]=b,d||(d=!0,setTimeout(function(){for(var e=0;e<c.length;++e){var b=c[e];if(a.hasOwnProperty(b)){a[b]();break}}d=!1;a={}},0))):b()}}(),d=function(c){for(var a=[],d={},b={},g=0;g<c.length;++g){var f=c[g];switch(f.type){case "hidden":case "text":case "email":!f.value||"hidden"!==f.type&&LPContentScriptTools.isVisible(f)||
(d.hasOwnProperty(f.value)?delete b[f.value]:(b[f.value]=f,d[f.value]=!0))}}var h={};LPContentScriptTools.findTextNodes({searches:Object.keys(b),searchAll:!0,exactMatch:!0,allowEmails:!0}).filter(function(c){return h.hasOwnProperty(c.match)?!1:h[c.match]=!0}).forEach(function(c){c.parent&&"OPTION"!==c.parent.nodeName&&LPContentScriptTools.isVisible(c.parent)&&a.push(b[c.match])});return a},f=function(c){var a={type:c.type,value:c.value,id:c.id,label:LPContentScriptTools.getLabel(c),attributes:LPContentScriptTools.getAttributes(c,
["name","ng-model","data-reactid"])};"password"!==a.type&&"disc"===$(c).css("text-security")&&(a.type="password");return a},g=function(c,a){for(var d=[],b=0;b<c.length;++b){var e=c[b];"password"!==e.inputData.type&&(e.inputData.value=q.getUnmaskedValue({input:e.input,inputValue:e.inputData.value,form:a.form}));e.inputData.formname=a.form&&a.form.getAttribute("name")||"";d.push(e.inputData)}return{url:document.location.href,top:window===top,fields:d,generatedPassword:a.generatedPassword,username:q.getUsername()}};
return function(c){var e=a(c.form);c.form&&(e=d(c.form).concat(e.toArray()));for(var p=[],k=0;k<e.length;++k){var m=e[k],h=f(m);p.push({input:m,inputData:h})}var l=g(p,c);c.deferred||b(c.type,function(){x(l)});return l}}(),B=function(){var a=function(a){var d;if(a.id)d=$(document.getElementById(a.id));else for(var c in a.attributes)if(d=$("input["+c+'="'+a.attributes[c]+'"]'),0<d.length)break;return d},b=function(d,b){for(var c=0;c<d.fields.length;++c){var e=d.fields[c];if("password"===e.type){var c=
e,e=d,f=b,g=a(c);g&&0<g.length&&LPContentScriptTools.isVisible(g)?f&&!LPContentScriptTools.isClickable(g)?(r=!0,c=!1):c=h&&e.passwordChangeForm?g.val()===c.value:!0:c=!1;return c}}return!1},d=function(){var d=function(d,c){var b=a(d);b&&b.unbind("input.submissionFailed").bind("input.submissionFailed",function(){c(!0)})};return function(a,c){for(var b=0;b<a.fields.length;++b){var f=a.fields[b];"password"===f.type&&d(f,c)}}}();return function(a,g){var c=0,e=null,f=!1,k=function(a){f||(h=!1,f=!0,clearInterval(e),
g(a))};h?(e=setInterval(function(){++c;var d=5===c,e=b(a,d);e&&!d||k(e)},1E3),d(a,k)):k(b(a))}}(),w=function(a){LPContentScriptTools.isUnloading()||(Topics.get(Topics.SITE_NOTIFICATION_STATE).publish(a),bg.get("LPContentScriptFeatures").new_save_site&&a.dialogData&&!r&&csTop.LPSiteNotification.showSiteNotification(a))},y=function(){var a=function(a){a=a.toLowerCase();return-1<a.indexOf("submit")||-1<a.indexOf("save")},b=function(d){d=d.attributes;for(var b=0;b<d.length;++b){var g=d[b];if(a(g.name)||
a(g.value))return!0}return!1};return function(a){if("INPUT"===a.nodeName)return"submit"===a.type?!0:"button"===a.type?b(a):!1;for(;a&&0===a.getElementsByTagName("input").length;){if("BUTTON"===a.nodeName)return"submit"===a.type||b(a);if(b(a))return!0;a=a.parentElement}return!1}}(),v=function(a){switch(a.nodeName){case "TEXTAREA":case "SELECT":return!0;case "INPUT":switch(a.type){case "button":case "submit":return!1;default:return!0}default:return!1}},l=function(){var a=null,b=[],d=function(){a&&(a.disconnect(),
a=null);b=[]},f=function(a){for(var c=0;c<a.length;++c){var b=a[c];switch(b.type){case "attributes":if(b.target.getAttribute(b.attributeName)!==b.oldValue)return!0;break;default:return!0}}return!1},g=function(a){f(a)&&(b.forEach(function(a){a()}),d())};return{reset:d,onChange:function(c){"undefined"!==typeof MutationObserver&&(a||(a=new MutationObserver(g),a.observe(document.body,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0})),-1===b.indexOf(c)&&b.push(c),setTimeout(function(){d()},
0))}}}(),t=function(){var a=null,b=null,d=function(){a&&(window.removeEventListener("lprequeststart",a),a=null)},f=function(){b&&(window.removeEventListener("lprequestend",b),b=null)};return{onStart:function(b){d();a=function(a){b(a.detail)};window.addEventListener("lprequeststart",a)},onEnd:function(a){f();var c=a.handler||a;b=a.requestID?function(b){b.detail.requestID===a.requestID&&c(b.detail)}:function(a){c(a.detail)};window.addEventListener("lprequestend",b)},reset:function(){d();f()}}}(),q=
function(){var a=null,b=!1,d=[];Topics.get(Topics.FILLED_GENERATED_PW).subscribe(function(a){g({target:a.element,generatedPassword:a.password})});Topics.get(Topics.CLEAR_DATA).subscribe(function(a){q()});Topics.get(Topics.LOGIN).subscribe(function(a){bg.LPTabState.getState(function(a){a.enabled&&n(a)})});var f=function(a){return function(b){if(!1!==b.isTrusted)try{a(b)}catch(C){console.log(C)}}},g=function(a){a.form=LPContentScriptTools.getForm(a.target);return u(a)},c=function(){h=!1;bg.LPTabState.clear()},
e=function(a){var b=a&&a.formData;if(b&&0<b.fields.length)t.onStart(function(c){var z=!1;if(c&&c.data)for(var d=0;d<b.fields.length;++d)if(-1<c.data.indexOf(b.fields[d].value)){z=!0;break}z&&(t.reset(),t.onEnd({requestID:c.requestID,handler:function(b){t.reset();a.responseHandler(b)}}))})},p=function(a){e({formData:a,responseHandler:function(a){200!==a.statusCode&&c()}})},k=function(a){var b=g({target:a,deferred:!0});e({formData:b,responseHandler:function(a){200===a.statusCode&&x(b)}})},m={submit:function(a){l.reset();
p(u({form:LPContentScriptTools.getForm(a.target),type:a.type}))},lpsubmit:function(a){l.reset();u({form:a.target,type:"submit"})},click:f(function(a){var b=a.target;if(y(b))l.reset(),p(g({target:b,type:a.type}));else if(!v(b)){if(h)l.onChange(c);k(b)}}),keydown:f(function(a){if(13===(a.keyCode||a.which)){var b=a.target;if(v(b)||y(b))l.reset(),p(g({target:b,type:a.type}));else{if(h)l.onChange(c);k(b)}}}),change:f(function(a){a=a.target;if("INPUT"===a.nodeName&&a.value)switch(a.type){case "text":case "email":for(var b=
0;b<d.length;++b)if(d[b].input===a){d[b].value=a.value;return}d.push({input:a,value:a.value})}}),paste:f(function(a){var b=a.target;v(a.target)&&bg.LPTabState.getCopiedGeneratedPassword(function(a){b.value===a&&g({target:b,generatedPassword:a})})})},n=function(c){a=c;if(!b){for(var d in m)document.addEventListener(d,m[d],!0);b=!0}},q=function(){if(b){for(var a in m)document.removeEventListener(a,m[a],!0);b=!1}d=[]},r=function(a){return-1<a.indexOf("*")||-1<a.indexOf(String.fromCharCode(8226))};(function(){var a=
document.children[0];if("HTML"===a.nodeName){var b=document.createElement("script");b.appendChild(document.createTextNode(LPContentScriptConstants.JS.PageWebRequestEvents));a.insertBefore(b,a.firstChild);a.removeChild(b)}})();return{setup:n,teardown:q,getUnmaskedValue:function(a){if(r(a.inputValue)){var b;for(b=0;b<d.length;++b){var c=d[b];if(c.input===a.input&&c.value!==a.inputValue)return c.value}if(a.form)for(b=0;b<a.form.length;++b){var e=c=a.form[b],f=a.inputValue;if(e.value&&!r(e.value)&&e.value.length===
f.length&&(e.value[0]===f[0]||e.value[e.value.length-1]===f[f.length-1]))return c.value}}return a.inputValue},getUsername:function(){"undefined"===typeof a.username&&a.usernames&&0<a.usernames.length&&(a.username=LPContentScriptTools.findText({searches:a.usernames}));return a.username}}}(),A=LPContentScriptTools.debounce(function(){bg.LPTabState.getSiteNotification({callback:w})},1E3,!0);Topics.get(Topics.INITIALIZED).subscribe(function(){bg.LPTabState.getState(function(a){a.enabled&&(q.setup(a),
window===top?A():a.formSubmittedFrame&&csTop.LPSiteNotification.getSiteNotification())})});window!==top&&window.addEventListener("beforeunload",function(){h&&csTop.LPSiteNotification.getSiteNotification()},!0);return{formExists:B,showSiteNotification:function(a){if(!n){n=!0;a.postSetup=function(){Topics.get(Topics.SITE_NOTIFICATION).publish(b)};var b=LPFrame.openDialog("contentScriptSite",a,{css:{top:10,right:10}});b.onClose(function(){n=!1})}},getSiteNotification:A}}();
